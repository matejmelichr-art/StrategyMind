<!doctype html>
<html lang="cs">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>StrategyMind — Market Scanner (demo)</title>
  <meta name="description" content="Vyhledávač akcií, indexů a krypto. Filtry, mini graf, roční predikce s tečkovaným cílem a podmínkami neplatnosti. Demo data.">
  <link rel="preconnect" href="https://cdn.tailwindcss.com">
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: { brand:"#0A2342", mint:"#2bd4a9" },
          boxShadow: { sweet:"0 24px 70px -24px rgba(2,6,23,.15)" },
          borderRadius: { "2xl":"1.25rem" }
        }
      }
    }
  </script>
  <style>
    .card{border:1px solid #e5e7eb;background:#fff;border-radius:1.25rem}
    .pill{border:1px solid #e5e7eb;border-radius:999px;padding:.35rem .7rem;background:#fff}
    .btn{border-radius:.9rem;padding:.7rem 1rem;font-weight:700}
    .btn-brand{background:#0A2342;color:#fff}
    .btn-ghost{background:#fff;border:1px solid #e5e7eb}
    .row{transition:background .15s ease}
    .row:hover{background:#f8fafc}
    .spark path.actual{fill:none;stroke:#3b82f6;stroke-width:2}
    .spark path.target{fill:none;stroke:#10b981;stroke-width:2;stroke-dasharray:5 4}
  </style>
</head>
<body class="bg-slate-50 text-slate-900 selection:bg-mint/20 selection:text-brand">

  <!-- Top bar -->
  <header class="sticky top-0 z-40 bg-white/80 backdrop-blur border-b">
    <div class="mx-auto max-w-7xl px-4 py-3 flex items-center gap-3">
      <a href="/" class="pill">← Zpět na homepage</a>
      <nav class="flex items-center gap-2 text-sm">
        <a class="pill" href="/client/">Klientská sekce</a>
        <span class="pill bg-slate-100">Market Scanner</span>
        <a class="pill" href="/client/real-estate/">Real-Estate</a>
        <a class="pill" href="/client/ideas/">Idea Lab</a>
      </nav>
      <div class="ml-auto">
        <button id="btnReport" class="btn btn-brand">Stáhnout report (MD)</button>
      </div>
    </div>
  </header>

  <main class="mx-auto max-w-7xl px-4 py-8">
    <h1 class="text-2xl md:text-3xl font-extrabold">Market Scanner</h1>
    <p class="mt-1 text-slate-600 max-w-[70ch]">
      Vyhledej a filtruj akcie, indexy a krypto. Klikni na řádek pro <em>důvod predikce</em>,
      <em>podmínky neplatnosti</em> a mini graf. V ostré verzi napojíme živá data a zprávy.
    </p>

    <!-- Controls -->
    <div class="mt-5 grid gap-3 md:grid-cols-[1fr,220px,220px]">
      <input id="q" class="rounded-xl border px-3 py-2" placeholder="Hledat symbol / název…">
      <select id="type" class="rounded-xl border px-3 py-2">
        <option value="">Všechny typy</option>
        <option value="stock">Akcie</option>
        <option value="index">Index</option>
        <option value="crypto">Krypto</option>
      </select>
      <select id="sort" class="rounded-xl border px-3 py-2">
        <option value="symbol">Seřadit: Symbol</option>
        <option value="pred">Seřadit: 1Y průměr predikce</option>
        <option value="conf">Seřadit: Důvěra</option>
      </select>
    </div>

    <!-- Table -->
    <section id="table" class="mt-5 card overflow-hidden">
      <div class="grid grid-cols-[120px_1fr_120px_100px_120px_100px_90px_96px] gap-3 px-4 py-3 text-xs font-semibold text-slate-500 border-b">
        <div>Symbol</div>
        <div>Název</div>
        <div class="text-right">Cena</div>
        <div class="text-right">1D %</div>
        <div class="text-right">1W %</div>
        <div class="text-right">1Y pred. (avg)</div>
        <div class="text-right">Conf.</div>
        <div></div>
      </div>
      <div id="rows"></div>
    </section>

    <p class="mt-3 text-xs text-slate-500">
      *Demo grafy generované z náhodných dat. Tečkovaná linka znázorňuje cílový bod (avg) v horizontu 1Y.
    </p>
  </main>

  <!-- Row template -->
  <template id="rowTpl">
    <div class="row border-b">
      <button class="w-full grid grid-cols-[120px_1fr_120px_100px_120px_100px_90px_96px] gap-3 px-4 py-3 text-sm items-center text-left">
        <div class="font-mono text-slate-700 sym"></div>
        <div class="name"></div>
        <div class="text-right price"></div>
        <div class="text-right d1"></div>
        <div class="text-right w1"></div>
        <div class="text-right pred"></div>
        <div class="text-right conf"></div>
        <div class="justify-self-end"><span class="pill text-xs">Detail</span></div>
      </button>
      <div class="hidden px-4 pb-4">
        <div class="grid md:grid-cols-[1fr_340px] gap-4">
          <div class="text-sm">
            <div class="flex items-center gap-2 mb-1">
              <span class="pill text-xs">Teze</span>
              <span class="text-slate-700 thesis"></span>
            </div>
            <div class="flex items-center gap-2">
              <span class="pill text-xs">Neplatí pokud</span>
              <span class="text-slate-700 invalid"></span>
            </div>
          </div>
          <div class="card p-3">
            <svg class="spark w-full h-[120px]" viewBox="0 0 320 120" aria-label="sparkline"></svg>
          </div>
        </div>
      </div>
    </div>
  </template>

  <script>
    // ---------- Demo data ----------
    const DATA = [
      {
        type:'stock', symbol:'AAPL', name:'Apple Inc.',
        price:219.85, d1:+1.26, w1:+2.10,
        pred:{min:165, avg:245, max:310},
        conf:72,
        thesis:'Růst služeb a ekosystému, stabilní marže. Re-rating po nové produktové linii.',
        invalid:'Breakdown pod 195 s objemy a slabý guidance.'
      },
      {
        type:'crypto', symbol:'BTCUSD', name:'Bitcoin',
        price:67200, d1:+2.30, w1:+6.80,
        pred:{min:42000, avg:88000, max:120000},
        conf:58,
        thesis:'Poptávka přes ETF, halving + omezená nabídka, sílící narativ digitálního zlata.',
        invalid:'Regulační tlak, silný risk-off, útok na síť.'
      },
      {
        type:'stock', symbol:'NVDA', name:'NVIDIA Corp.',
        price:108.20, d1:-0.82, w1:+3.40,
        pred:{min:85, avg:150, max:230},
        conf:69,
        thesis:'AI akcelerace datacenter, ekosystém CUDA. Růst inference.',
        invalid:'Zpomalení hyperscaler capexu, restrikce exportu.'
      },
      {
        type:'index', symbol:'SPY', name:'S&P 500 ETF',
        price:520.10, d1:+0.41, w1:+1.05,
        pred:{min:475, avg:585, max:640},
        conf:64,
        thesis:'Široký růst zisků, „soft landing“, klesající inflace.',
        invalid:'Šok na sazbách/nezaměstnanosti, eskalace geopolitiky.'
      }
    ];

    // ---------- Rendering ----------
    const rowsEl = document.getElementById('rows');
    const tpl = document.getElementById('rowTpl');

    function pct(v){
      const c = v>=0 ? 'text-emerald-600' : 'text-rose-600';
      const s = (v>0?'+':'') + v.toFixed(2) + '%';
      return `<span class="${c}">${s}</span>`;
    }
    function money(v){
      // Kč/ USD—pro demo nechme prostě číslo s mezerou pro BTC
      return Intl.NumberFormat('cs-CZ').format(v);
    }

    function drawSpark(svg, points, targetY){
      const w = 320, h = 120, pad = 10;
      const xs = points.map((_,i)=> pad + i*( (w-2*pad)/(points.length-1) ));
      const min = Math.min(...points), max = Math.max(...points);
      const y = v => h-pad - ( (v-min)/(max-min||1) )*(h-2*pad);

      // Path actual
      const d = points.map((v,i)=> (i?'L':'M') + xs[i] + ',' + y(v)).join(' ');
      const p1 = document.createElementNS('http://www.w3.org/2000/svg','path');
      p1.setAttribute('class','actual');
      p1.setAttribute('d', d);
      svg.appendChild(p1);

      // Dashed target (horizontal to last x)
      const lastX = xs[xs.length-1];
      const ty = y(targetY);
      const p2 = document.createElementNS('http://www.w3.org/2000/svg','path');
      p2.setAttribute('class','target');
      p2.setAttribute('d', `M ${lastX-60},${ty} L ${lastX},${ty}`);
      svg.appendChild(p2);
    }

    function randSeries(base){
      const out = [base* (0.96+Math.random()*0.08)];
      for(let i=1;i<24;i++){
        const prev = out[i-1];
        out.push(prev*(0.985 + Math.random()*0.03));
      }
      return out;
    }

    function render(list){
      rowsEl.innerHTML = '';
      list.forEach(item=>{
        const node = tpl.content.cloneNode(true);
        node.querySelector('.sym').textContent = item.symbol;
        node.querySelector('.name').textContent = item.name;
        node.querySelector('.price').textContent = money(item.price);
        node.querySelector('.d1').innerHTML = pct(item.d1);
        node.querySelector('.w1').innerHTML = pct(item.w1);
        node.querySelector('.pred').innerHTML = `${money(item.pred.avg)}`;
        node.querySelector('.conf').textContent = item.conf + '%';
        node.querySelector('.thesis').textContent = item.thesis;
        node.querySelector('.invalid').textContent = item.invalid;

        const row = node.querySelector('.row');
        const btn = row.querySelector('button');
        const detail = row.querySelector('.hidden');

        btn.addEventListener('click', ()=>{
          detail.classList.toggle('hidden');
          const svg = row.querySelector('svg.spark');
          if(!svg.dataset.drawn){
            const base = item.price/1.2;
            drawSpark(svg, randSeries(base), item.pred.avg);
            svg.dataset.drawn = '1';
          }
        });

        rowsEl.appendChild(node);
      });
    }

    // ---------- Filters & sort ----------
    const q = document.getElementById('q');
    const type = document.getElementById('type');
    const sort = document.getElementById('sort');

    function apply(){
      let out = DATA.slice();

      const s = q.value.trim().toLowerCase();
      if(s) out = out.filter(x => x.symbol.toLowerCase().includes(s) || x.name.toLowerCase().includes(s));

      if(type.value) out = out.filter(x => x.type === type.value);

      if(sort.value==='pred') out.sort((a,b)=> b.pred.avg - a.pred.avg);
      else if(sort.value==='conf') out.sort((a,b)=> b.conf - a.conf);
      else out.sort((a,b)=> a.symbol.localeCompare(b.symbol));

      render(out);
    }
    q.addEventListener('input', apply);
    type.addEventListener('change', apply);
    sort.addEventListener('change', apply);

    // Report (demo .md stáhne lokální text)
    document.getElementById('btnReport').addEventListener('click', ()=>{
      const md = [
        '# StrategyMind – Market Scanner (demo)',
        '',
        ...DATA.map(x=>`## ${x.symbol} — ${x.name}
- Cena: ${money(x.price)}
- 1D: ${(x.d1>0?'+':'')+x.d1.toFixed(2)} %
- 1W: ${(x.w1>0?'+':'')+x.w1.toFixed(2)} %
- Predikce 1Y (min/avg/max): ${money(x.pred.min)} / ${money(x.pred.avg)} / ${money(x.pred.max)}
- Důvěra: ${x.conf} %
- Teze: ${x.thesis}
- Neplatí pokud: ${x.invalid}
`)
      ].join('\n');
      const blob = new Blob([md], {type:'text/markdown'});
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = 'strategymind_market_report.md';
      a.click();
      URL.revokeObjectURL(a.href);
    });

    // Initial render
    apply();
  </script>
</body>
</html>
