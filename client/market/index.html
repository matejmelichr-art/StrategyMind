<!doctype html>
<html lang="cs">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>StrategyMind — Market Forecast (demo)</title>

  <!-- Tailwind přes CDN (kvůli rychlému layoutu) -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

  <style>
    /* jemný gradient pozadí jako TradingView mood */
    body { background: radial-gradient(1200px 600px at 70% 10%, #f8fafc 0, #ffffff 60%); }
    .chip { @apply inline-flex items-center rounded-full border border-slate-200 px-2 py-0.5 text-xs text-slate-600; }
    .legend-dot{ width:.65rem;height:.65rem;border-radius:50%;display:inline-block;margin-right:.35rem; }
  </style>
</head>
<body class="min-h-screen text-slate-900">
  <header class="sticky top-0 z-10 backdrop-blur bg-white/70 border-b border-slate-200">
    <div class="mx-auto max-w-6xl px-4 py-3 flex items-center gap-3">
      <a href="/" class="text-sm text-slate-600 hover:text-slate-900">← Zpět na homepage</a>
      <div class="ml-auto flex gap-2">
        <a href="/client/" class="chip">Klientská sekce</a>
        <span class="chip">Market Scanner</span>
      </div>
    </div>
  </header>

  <main class="mx-auto max-w-6xl px-4 py-8">
    <div class="mb-6">
      <h1 class="text-2xl md:text-3xl font-semibold tracking-tight">NVDA — 1Y forecast (demo)</h1>
      <p class="text-slate-600 mt-1">Historie ceny + predikce (min / avg / max) s vyznačením současné ceny. V ostré verzi sem napojíme AI a živá data.</p>
    </div>

    <section class="grid gap-6 md:grid-cols-12">
      <!-- Graf -->
      <div class="md:col-span-9 rounded-2xl border border-slate-200 bg-white shadow-sm p-4 md:p-6">
        <div class="flex items-center justify-between mb-4">
          <div class="flex items-center gap-2">
            <span class="chip">Předpověď 1Y</span>
            <span class="chip">Past 2Y</span>
          </div>
          <div class="text-sm text-slate-500">*Demo data</div>
        </div>
        <canvas id="forecastChart" height="110"></canvas>
      </div>

      <!-- Info panel vpravo (etikety jako na screenu) -->
      <aside class="md:col-span-3 rounded-2xl border border-slate-200 bg-white shadow-sm p-4 md:p-6">
        <h3 class="font-semibold mb-4">Etikety &amp; hodnoty</h3>
        <ul class="space-y-2 text-sm">
          <li class="flex items-center justify-between">
            <span><span class="legend-dot" style="background:#0ea5e9"></span>Current</span>
            <span id="lab-current" class="font-medium">—</span>
          </li>
          <li class="flex items-center justify-between">
            <span><span class="legend-dot" style="background:#14b8a6"></span>Avg (1Y)</span>
            <span id="lab-avg" class="font-medium text-emerald-600">—</span>
          </li>
          <li class="flex items-center justify-between">
            <span><span class="legend-dot" style="background:#22c55e"></span>Max (1Y)</span>
            <span id="lab-max" class="font-medium">—</span>
          </li>
          <li class="flex items-center justify-between">
            <span><span class="legend-dot" style="background:#ef4444"></span>Min (1Y)</span>
            <span id="lab-min" class="font-medium">—</span>
          </li>
        </ul>
        <hr class="my-5">
        <div class="space-y-2 text-sm">
          <div class="flex items-center justify-between">
            <span>Confidence</span><span id="lab-conf" class="font-medium">—</span>
          </div>
          <div class="flex items-center justify-between">
            <span>Analyst stance</span><span id="lab-stance" class="font-medium">Strong buy</span>
          </div>
        </div>
      </aside>
    </section>

    <!-- Poznámky k predikci -->
    <section class="mt-8 grid gap-6 md:grid-cols-2">
      <div class="rounded-2xl border border-slate-200 bg-white shadow-sm p-4 md:p-6">
        <h3 class="font-semibold mb-3">Teze</h3>
        <p id="lab-thesis" class="text-slate-700">
          Růst AI segmentu, silný pipeline, rozšiřující se marže. Re-rating po nové produktové linii.
        </p>
      </div>
      <div class="rounded-2xl border border-slate-200 bg-white shadow-sm p-4 md:p-6">
        <h3 class="font-semibold mb-3">Neplatí, pokud</h3>
        <p id="lab-invalid" class="text-slate-700">
          Breakdown pod klíčovým supportem a prudká komprese marží / poptávky.
        </p>
      </div>
    </section>
  </main>

  <script>
    /**
     * Jednoduchý renderer forecast grafu ve stylu „fan chart“.
     * Vstupní data můžeš nahradit AI/živými daty.
     */
    function renderForecast({
      symbol = "NVDA",
      history = [],           // [{t: '2024-01', v: 120}, ...]
      current,                // číslo
      forecastMonths = 12,    // kolik bodů dopředu
      minTarget, avgTarget, maxTarget, // cílové hodnoty po 12 měsících
      confidence = 0.72,      // 0–1
      thesis = "", invalidation = ""
    }) {
      // Etikety
      document.querySelector('#lab-current').textContent = formatUSD(current);
      document.querySelector('#lab-avg').textContent     = formatUSD(avgTarget);
      document.querySelector('#lab-max').textContent     = formatUSD(maxTarget);
      document.querySelector('#lab-min').textContent     = formatUSD(minTarget);
      document.querySelector('#lab-conf').textContent    = Math.round(confidence * 100) + "%";
      if (thesis)      document.querySelector('#lab-thesis').textContent  = thesis;
      if (invalidation)document.querySelector('#lab-invalid').textContent = invalidation;

      // Připrav osy/etikety
      const histLabels = history.map(p => p.t);
      const histData   = history.map(p => p.v);

      // generuj 12 budoucích měsíců
      const futureLabels = [];
      const now = new Date();
      for (let i = 1; i <= forecastMonths; i++) {
        const d = new Date(now.getFullYear(), now.getMonth() + i, 1);
        futureLabels.push(d.toLocaleString('en', {month:'short'}));
      }

      // Interpolace min/avg/max od current -> target
      const interp = (to) => {
        const arr = [];
        for (let i = 1; i <= forecastMonths; i++) {
          const v = current + (to - current) * (i / forecastMonths);
          arr.push(v);
        }
        return arr;
      };
      const futMin = interp(minTarget);
      const futAvg = interp(avgTarget);
      const futMax = interp(maxTarget);

      const labels = [...histLabels, ...futureLabels];

      // Dataset historie
      const historyDataset = {
        type: 'line',
        label: symbol + ' (historie)',
        data: [...histData, null], // null v bodě přechodu
        borderColor: '#0ea5e9',
        borderWidth: 2,
        tension: 0.3,
        pointRadius: 0
      };

      // „Fan“ – min/max vyplněný kužel
      const minDataset = {
        type: 'line',
        label: 'Min (1Y)',
        data: [...Array(histData.length).fill(null), ...futMin],
        borderColor: '#ef4444',
        borderWidth: 1.5,
        pointRadius: 0,
        tension: 0.3,
        fill: false
      };
      const maxDataset = {
        type: 'line',
        label: 'Max (1Y)',
        data: [...Array(histData.length).fill(null), ...futMax],
        borderColor: '#22c55e',
        borderWidth: 1.5,
        pointRadius: 0,
        tension: 0.3,
        fill: '-1' // vyplní prostor mezi max a předešlým datasetem (min)
      };
      // poloprůhledná výplň kužele
      const fillPlugin = {
        id: 'fanFill',
        beforeDatasetsDraw(chart, args, opts) {
          const {ctx, chartArea, scales} = chart;
          const y = scales.y;
          const x = scales.x;
          ctx.save();
          ctx.globalAlpha = 0.12;
          ctx.fillStyle = '#10b981';
          ctx.beginPath();
          // pro jednoduchost spojíme oba budoucí průběhy
          const n = futMin.length;
          // horní hrana (max) zleva doprava
          for (let i = 0; i < n; i++) {
            const xi = x.getPixelForValue(histLabels.length + i);
            const yi = y.getPixelForValue(futMax[i]);
            if (i === 0) ctx.moveTo(xi, yi); else ctx.lineTo(xi, yi);
          }
          // spodní hrana (min) zprava doleva
          for (let i = n - 1; i >= 0; i--) {
            const xi = x.getPixelForValue(histLabels.length + i);
            const yi = y.getPixelForValue(futMin[i]);
            ctx.lineTo(xi, yi);
          }
          ctx.closePath();
          ctx.fill();
          ctx.restore();
        }
      };

      // Avg předpověď – zvýrazněná
      const avgDataset = {
        type: 'line',
        label: 'Avg (1Y)',
        data: [...Array(histData.length).fill(null), ...futAvg],
        borderColor: '#14b8a6',
        borderWidth: 2.5,
        pointRadius: 0,
        tension: 0.35
      };

      // Čárkovaná „current“ baseline (vodorovná od splitu)
      const currentLine = {
        id: 'currentLine',
        afterDatasetsDraw(chart, args, pluginOptions) {
          const {ctx, scales} = chart;
          const y = scales.y.getPixelForValue(current);
          const xLeft  = scales.x.getPixelForValue(histLabels.length - 0.1);
          const xRight = scales.x.getPixelForValue(labels.length - 1);
          ctx.save();
          ctx.setLineDash([6,6]);
          ctx.strokeStyle = '#0ea5e9';
          ctx.lineWidth = 1.5;
          ctx.beginPath();
          ctx.moveTo(xLeft, y);
          ctx.lineTo(xRight, y);
          ctx.stroke();
          ctx.restore();
        }
      };

      // Vertikální oddělovač (konec historie)
      const splitLine = {
        id: 'splitLine',
        afterDatasetsDraw(chart) {
          const {ctx, scales, chartArea} = chart;
          const x = scales.x.getPixelForValue(histLabels.length - 0.02);
          ctx.save();
          ctx.strokeStyle = '#94a3b8';
          ctx.setLineDash([3,4]);
          ctx.beginPath();
          ctx.moveTo(x, chartArea.top);
          ctx.lineTo(x, chartArea.bottom);
          ctx.stroke();
          ctx.restore();
        }
      };

      // vykreslení grafu
      const ctx = document.getElementById('forecastChart').getContext('2d');
      if (window._forecastChart) window._forecastChart.destroy();
      window._forecastChart = new Chart(ctx, {
        data: { labels, datasets: [historyDataset, minDataset, maxDataset, avgDataset] },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          interaction: { mode: 'index', intersect: false },
          plugins: {
            legend: { display: false },
            tooltip: {
              callbacks: {
                label: (context) => `${context.dataset.label}: ${formatUSD(context.parsed.y)}`
              }
            }
          },
          scales: {
            x: { grid: { display: false } },
            y: { grid: { color: 'rgba(148,163,184,.2)' } }
          }
        },
        plugins: [fillPlugin, currentLine, splitLine]
      });
    }

    // Pomocné formátování
    function formatUSD(v){ return Intl.NumberFormat('en-US',{style:'currency',currency:'USD',maximumFractionDigits:2}).format(v); }

    // ------- DEMO DATA (můžeš zahodit a napojit AI/živá data) -------
    (function runDemo(){
      // 24 měsíců historie (umělé čísla kvůli ukázce)
      const start = 24, seed = 120;
      const history = Array.from({length: start}, (_,i)=>{
        const d = new Date(); d.setMonth(d.getMonth()-(start-i));
        const v = seed + i*4 + (Math.sin(i/2)*8) + (i>16? i*1.6 : 0);
        return { t: d.toLocaleString('en',{month:'short'})+' '+d.getFullYear().toString().slice(2), v: Math.max(40, Math.round(v*100)/100) };
      });
      const current = history[history.length-1].v;

      renderForecast({
        symbol: "NVDA",
        history,
        current,
        forecastMonths: 12,
        minTarget: current*0.53,   // ~ -47%
        avgTarget: current*1.1626,  // +16.26% jako ve screenu
        maxTarget: current*2.06,    // ~ +106%
        confidence: 0.72,
        thesis: "Růst AI poptávky, rozšíření produktové řady, stabilní marže — prostor pro re-rating.",
        invalidation: "Ztráta klíčového supportu a dlouhodobý útlum poptávky by predikci negoval."
      });
    })();
  </script>
</body>
</html>
