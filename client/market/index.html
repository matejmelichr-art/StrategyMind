<!doctype html>
<html lang="cs">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>StrategyMind — Market Scanner (demo v2)</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com?plugins=forms"></script>
  <style>
    html,body{ font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial; }
    .spark path.avg   { stroke-width: 2; fill: none; }
    .spark path.min,
    .spark path.max   { stroke-width: 2; fill: none; stroke-dasharray: 4 4; }
    .row:hover { background: #f8fafc; }
    .pill { padding:.375rem .625rem; border-radius:9999px; border:1px solid rgba(15,23,42,.08); }
    .kbd { background:#f3f4f6; padding:.125rem .375rem; border-radius:.25rem; font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Courier New", monospace; font-size:.75rem; }
  </style>
</head>
<body class="bg-slate-50 text-slate-900">
  <header class="sticky top-0 z-20 backdrop-blur bg-white/80 border-b border-slate-200">
    <div class="max-w-6xl mx-auto px-4 py-3 flex items-center gap-3">
      <a href="/client/" class="text-sm text-slate-600 hover:text-slate-900 flex items-center gap-2">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" class="opacity-70"><path d="M15 6l-6 6 6 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
        Zpět na klientskou sekci
      </a>
      <div class="ml-auto flex items-center gap-2">
        <a href="/client/market/" class="pill bg-white font-medium">Market Scanner</a>
        <a href="/client/real-estate/" class="pill">Real-Estate</a>
        <a href="/client/idea-lab/" class="pill">Idea Lab</a>
        <span class="ml-2 text-xs text-slate-500 border border-slate-200 rounded-full px-2 py-1 select-none">v2</span>
      </div>
    </div>
  </header>

  <main class="max-w-6xl mx-auto px-4 py-8">
    <h1 class="text-3xl font-semibold tracking-tight">Market Scanner</h1>
    <p class="mt-2 text-slate-600 max-w-3xl">
      Vyhledej a filtruj akcie, indexy a krypto. Řádek <strong>rozklikni</strong> pro tezi predikce, podmínky neplatnosti
      a <strong>mini-graf</strong> s 1Y rozmezím (<em>min / avg / max</em>). V demu jsou statická data.
    </p>

    <!-- Toolbar -->
    <div class="mt-6 grid grid-cols-1 md:grid-cols-3 gap-3">
      <div class="relative">
        <input id="q" class="w-full px-3 py-2 rounded-lg border border-slate-200 bg-white outline-none focus:ring-2 focus:ring-slate-200"
               placeholder="Hledej symbol / název…" />
        <div class="absolute inset-y-0 right-2 flex items-center text-slate-400 pointer-events-none">
          <span class="kbd">/</span>
        </div>
      </div>
      <select id="typeFilter" class="w-full px-3 py-2 rounded-lg border border-slate-200 bg-white outline-none focus:ring-2 focus:ring-slate-200">
        <option value="">Všechny typy</option>
        <option value="stock">Akcie</option>
        <option value="crypto">Krypto</option>
        <option value="index">Index</option>
      </select>
      <select id="sortBy" class="w-full px-3 py-2 rounded-lg border border-slate-200 bg-white outline-none focus:ring-2 focus:ring-slate-200">
        <option value="symbol">Seřadit: Symbol</option>
        <option value="price">Seřadit: Cena</option>
        <option value="w1">Seřadit: 1W %</option>
        <option value="conf">Seřadit: Confidence</option>
      </select>
    </div>

    <!-- Table -->
    <div class="mt-5 overflow-hidden rounded-2xl border border-slate-200 bg-white shadow-sm">
      <div class="grid grid-cols-[110px,1fr,120px,110px,110px,230px,90px,90px] px-4 py-2 text-sm font-medium text-slate-500 bg-slate-50">
        <div>Symbol</div>
        <div>Název</div>
        <div class="text-right">Cena</div>
        <div class="text-right">1D %</div>
        <div class="text-right">1W %</div>
        <div class="text-center">1Y predikce <span class="text-slate-400">(min / avg / max)</span></div>
        <div class="text-right">Conf.</div>
        <div></div>
      </div>
      <div id="rows"></div>
    </div>

    <p class="mt-3 text-xs text-slate-500">* Demo verze se statickými daty. V ostré verzi připojíme AI teze + zprávy + živé ceny.</p>
  </main>

  <script>
    // helpers
    const fmt = new Intl.NumberFormat('cs-CZ', { maximumFractionDigits: 2 });
    const pct = v => (v >= 0 ? '+' : '') + v.toFixed(2) + '%';
    const cls = v => v >= 0 ? 'text-emerald-600' : 'text-rose-600';

    // data (demo)
    const rows = [
      {
        type:'stock', symbol:'AAPL', name:'Apple Inc.',
        price: 219.85, d1: 1.26, w1: 2.10,
        forecast: { min:165, avg:245, max:310, conf:72 },
        thesis: 'Růst služeb a ekosystému, stabilní marže. Re-rating po nové produktové linii.',
        invalid: 'Breakdown pod 195 s objemy a slabá guidance.',
        path: { avg:[0,1,1.8,1.4,2.1,2.0,2.5], min:[0,-0.5,-0.2,-0.7,-0.4,-0.8,-1.1], max:[0,1.6,2.3,1.9,2.7,2.5,3.1] }
      },
      {
        type:'crypto', symbol:'BTCUSD', name:'Bitcoin',
        price: 67200, d1: 2.30, w1: 6.80,
        forecast: { min:42000, avg:88000, max:120000, conf:58 },
        thesis: 'Poptávka přes ETF, halving + omezená nabídka, sílící narativ „digitální zlato“.',
        invalid: 'Regulační tlak, silný risk-off, útok na síť.',
        path: { avg:[0,1.1,1.0,1.3,1.45,1.42,1.55], min:[0,0.2,0.1,0.15,0.1,0.05,0], max:[0,1.7,1.9,2.2,2.4,2.5,2.8] }
      },
      {
        type:'stock', symbol:'NVDA', name:'NVIDIA Corporation',
        price: 241.80, d1: 1.85, w1: 4.10,
        forecast: { min:128, avg:281, max:498, conf:72 },
        thesis: 'Udržitelná poptávka po AI akcelerátorech, expanze do datacenter a softwaru.',
        invalid: 'Cyklus investic do DC se zpomalí, regulace vývozu čipů.',
        path: { avg:[0,0.6,0.9,0.7,1.2,1.6,1.9], min:[0,-0.3,-0.4,-0.5,-0.7,-0.8,-1.0], max:[0,1.2,1.6,1.5,2.0,2.6,3.0] }
      }
    ];

    const container = document.getElementById('rows');

    function pathFrom(points, width=180, height=64, pad=4){
      const max = Math.max(...points.map(v=>Math.abs(v))) || 1;
      const step = (width - pad*2) / (points.length-1);
      const scaleY = (v)=> (height/2 - (v/max)*(height/2 - pad));
      const scaleX = (i)=> pad + i*step;
      let d = '';
      points.forEach((v,i)=>{
        const x = scaleX(i);
        const y = scaleY(v);
        d += (i===0?`M${x},${y}`:` L${x},${y}`);
      });
      return d;
    }

    function sparkSVG(series){
      const w=220,h=72;
      const dAvg = pathFrom(series.avg, w, h);
      const dMin = pathFrom(series.min, w, h);
      const dMax = pathFrom(series.max, w, h);
      return `
        <svg width="${w}" height="${h}" viewBox="0 0 ${w} ${h}" class="spark">
          <path class="min" stroke="#ef4444" d="${dMin}"></path>
          <path class="max" stroke="#22c55e" d="${dMax}"></path>
          <path class="avg" stroke="#2563eb" d="${dAvg}"></path>
        </svg>`;
    }

    function renderRow(r){
      const row = document.createElement('div');
      row.className = "row";
      row.innerHTML = `
        <div class="grid grid-cols-[110px,1fr,120px,110px,110px,230px,90px,90px] items-center px-4 py-3 border-t border-slate-100 cursor-pointer">
          <div class="font-semibold">${r.symbol}</div>
          <div class="text-slate-700">${r.name}</div>
          <div class="text-right tabular-nums">${fmt.format(r.price)}</div>
          <div class="text-right tabular-nums ${r.d1>=0?'text-emerald-600':'text-rose-600'}">${pct(r.d1)}</div>
          <div class="text-right tabular-nums ${r.w1>=0?'text-emerald-600':'text-rose-600'}">${pct(r.w1)}</div>
          <div class="text-center tabular-nums">
            ${fmt.format(r.forecast.min)} / <span class="font-semibold">${fmt.format(r.forecast.avg)}</span> / ${fmt.format(r.forecast.max)}
          </div>
          <div class="text-right tabular-nums">${r.forecast.conf}%</div>
          <div class="text-right">
            <button class="px-3 py-1.5 text-sm rounded-lg border border-slate-200 hover:bg-slate-50">Detail</button>
          </div>
        </div>
        <div class="hidden px-4 pb-4">
          <div class="grid md:grid-cols-[260px,1fr,1fr] gap-6 mt-3 rounded-xl border border-slate-100 bg-slate-50 p-4">
            <div>
              <div class="text-xs text-slate-500 mb-1">Mini-graf — 1Y (demo)</div>
              <div class="rounded-lg border border-slate-200 bg-white p-2 flex items-center justify-center">
                ${sparkSVG(r.path)}
              </div>
              <div class="mt-1 text-[11px] text-slate-500">Plná čára: <b>avg</b> · čárkovaně: <b>min/max</b></div>
            </div>
            <div class="text-sm">
              <div class="text-slate-500 mb-1">Teze</div>
              <div class="bg-white border border-slate-200 rounded-lg p-3">${r.thesis}</div>
            </div>
            <div class="text-sm">
              <div class="text-slate-500 mb-1">Neplatí, pokud</div>
              <div class="bg-white border border-slate-200 rounded-lg p-3">${r.invalid}</div>
              <div class="mt-3 text-xs text-slate-500">*Ukázková data, demo verze.</div>
            </div>
          </div>
        </div>
      `;
      const head = row.querySelector('.grid');
      const detailBtn = row.querySelector('button');
      const panel = row.children[1];
      function toggle(){ panel.classList.toggle('hidden'); }
      head.addEventListener('click', (e)=>{
        if(e.target.tagName.toLowerCase() === 'button') return;
        toggle();
      });
      detailBtn.addEventListener('click', (e)=>{ e.stopPropagation(); toggle(); });
      container.appendChild(row);
    }

    function render(list){
      container.innerHTML = '';
      list.forEach(renderRow);
    }

    const q = document.getElementById('q');
    const typeFilter = document.getElementById('typeFilter');
    const sortBy = document.getElementById('sortBy');

    function apply(){
      const term = q.value.trim().toLowerCase();
      let out = rows.filter(r =>
        (!typeFilter.value || r.type === typeFilter.value) &&
        (!term || r.symbol.toLowerCase().includes(term) || r.name.toLowerCase().includes(term))
      );
      switch(sortBy.value){
        case 'price': out.sort((a,b)=> b.price - a.price); break;
        case 'w1': out.sort((a,b)=> b.w1 - a.w1); break;
        case 'conf': out.sort((a,b)=> b.forecast.conf - a.forecast.conf); break;
        default: out.sort((a,b)=> a.symbol.localeCompare(b.symbol));
      }
      render(out);
    }

    q.addEventListener('input', apply);
    typeFilter.addEventListener('change', apply);
    sortBy.addEventListener('change', apply);
    document.addEventListener('keydown', (e)=>{ if(e.key === '/') { e.preventDefault(); q.focus(); }});

    apply(); // initial
  </script>
</body>
</html>
