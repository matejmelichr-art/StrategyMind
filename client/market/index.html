<!doctype html>
<html lang="cs" class="h-full bg-slate-50">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Market Scanner — StrategyMind (demo)</title>

  <!-- Tailwind (CDN) -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Chart.js pro mini-graf v modalu -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

  <style>
    .card { @apply bg-white rounded-2xl shadow-sm ring-1 ring-slate-200; }
    .pill { @apply inline-flex items-center rounded-full px-2.5 py-1 text-xs font-medium; }
    .pill-blue { @apply bg-blue-50 text-blue-700; }
    .pill-amber { @apply bg-amber-50 text-amber-700; }
    .num { font-variant-numeric: tabular-nums; }
  </style>
</head>
<body class="min-h-full">

  <!-- Top bar -->
  <header class="w-full bg-white/70 backdrop-blur border-b border-slate-200 sticky top-0 z-30">
    <div class="mx-auto max-w-6xl px-4 py-3 flex items-center gap-3">
      <a href="/client/" class="text-slate-500 hover:text-slate-700 text-sm">← Zpět na klientskou sekci</a>
      <nav class="ml-auto flex gap-2">
        <a href="/client/market/" class="pill pill-blue">Market Scanner</a>
        <a href="/client/real-estate/" class="pill bg-slate-100 text-slate-700">Real-Estate</a>
        <a href="/client/ideas/" class="pill bg-slate-100 text-slate-700">Idea Lab</a>
      </nav>
    </div>
  </header>

  <main class="mx-auto max-w-6xl px-4 py-8">
    <section class="mb-6">
      <h1 class="text-3xl font-semibold tracking-tight text-slate-900">Market Scanner</h1>
      <p class="text-slate-600 mt-2">
        Vyhledej a filtruj akcie, indexy a krypto. Rozklikni řádek pro
        <em class="italic">tezi predikce</em>, <em class="italic">podmínky neplatnosti</em>
        a mini-graf s 1Y rozmezím (<strong>min / avg / max</strong>).
        V ostré verzi napojíme živá data a zprávy.
      </p>
    </section>

    <!-- Filtry -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-3 mb-4">
      <input id="q" type="search" placeholder="Hledej symbol / název…" class="card px-4 py-2.5 outline-none focus:ring-2 ring-slate-200 focus:ring-blue-500"/>
      <select id="typeFilter" class="card px-4 py-2.5">
        <option value="all">Všechny typy</option>
        <option value="stock">Akcie</option>
        <option value="crypto">Krypto</option>
        <option value="index">Indexy</option>
      </select>
      <select id="sortBy" class="card px-4 py-2.5">
        <option value="symbol">Seřadit: Symbol</option>
        <option value="name">Seřadit: Název</option>
        <option value="price">Seřadit: Cena</option>
        <option value="conf">Seřadit: Confidence</option>
      </select>
    </div>

    <!-- Tabulka -->
    <div class="card overflow-hidden">
      <table class="w-full text-sm">
        <thead class="bg-slate-50/60 text-slate-600">
          <tr>
            <th class="text-left px-4 py-3 font-medium">Symbol</th>
            <th class="text-left px-4 py-3 font-medium">Název</th>
            <th class="text-right px-4 py-3 font-medium">Cena</th>
            <th class="text-right px-4 py-3 font-medium">1D %</th>
            <th class="text-right px-4 py-3 font-medium">1W %</th>
            <th class="text-right px-4 py-3 font-medium">
              1Y predikce<br><span class="text-xs text-slate-400">(min / <b>avg</b> / max)</span>
            </th>
            <th class="text-right px-4 py-3 font-medium">Conf.</th>
            <th class="px-4 py-3"></th>
          </tr>
        </thead>
        <tbody id="rows" class="divide-y divide-slate-100 bg-white"></tbody>
      </table>
    </div>

    <p class="text-xs text-slate-500 mt-3">* V demu jsou statická data. V ostré verzi bude AI teze + zprávy + živé ceny.</p>
  </main>

  <!-- Modal (Detail) -->
  <div id="modal" class="fixed inset-0 z-50 hidden">
    <div class="absolute inset-0 bg-slate-900/50" onclick="closeModal()"></div>
    <div class="relative mx-auto mt-16 max-w-3xl w-[92%]">
      <div class="card p-5">
        <div class="flex items-start justify-between gap-4">
          <div>
            <h3 id="mTitle" class="text-xl font-semibold text-slate-900">Symbol — Detail</h3>
            <p id="mSubtitle" class="text-slate-500 text-sm">Teze & podmínky neplatnosti</p>
          </div>
          <button class="pill bg-slate-100 text-slate-700" onclick="closeModal()">Zavřít</button>
        </div>

        <div class="mt-5 grid grid-cols-1 lg:grid-cols-[1fr_280px] gap-5">
          <!-- Graf -->
          <div class="card p-4">
            <div class="flex items-center justify-between mb-2">
              <div class="text-sm text-slate-500">Historie + 1Y predikce</div>
              <div class="text-xs text-slate-400">* Demo</div>
            </div>
            <canvas id="mChart" width="640" height="280"></canvas>
          </div>

          <!-- Popis a čísla -->
          <aside class="card p-4">
            <div class="space-y-3">
              <div>
                <span class="pill pill-blue">Teze</span>
                <p id="mThesis" class="mt-2 text-slate-700 text-sm"></p>
              </div>
              <div>
                <span class="pill pill-amber">Neplatí, pokud</span>
                <p id="mInvalid" class="mt-2 text-slate-700 text-sm"></p>
              </div>
              <hr class="my-2">
              <dl class="grid grid-cols-2 gap-x-3 gap-y-1 text-sm">
                <dt class="text-slate-500">Aktuální</dt><dd id="vCur" class="num text-right font-medium"></dd>
                <dt class="text-slate-500">Avg (1Y)</dt><dd id="vAvg" class="num text-right"></dd>
                <dt class="text-slate-500">Max (1Y)</dt><dd id="vMax" class="num text-right"></dd>
                <dt class="text-slate-500">Min (1Y)</dt><dd id="vMin" class="num text-right"></dd>
                <dt class="text-slate-500">Confidence</dt><dd id="vConf" class="num text-right"></dd>
              </dl>
            </div>
          </aside>
        </div>
      </div>
    </div>
  </div>

  <script>
    // ---------- Demo data ----------
    const data = [
      {
        symbol: 'AAPL', name: 'Apple Inc.', type: 'stock',
        price: 219.85, d1: 1.26, w1: 2.10, conf: 0.72,
        forecast: { min:165, avg:245, max:310 },
        thesis: 'Růst služeb a ekosystému, stabilní marže. Re-rating po nové produktové linii.',
        invalid: 'Neplatí při breakdownu pod 195 s objemy a slabé guidance.',
        history: [180,188,191,195,192,199,204,207,210,206,212,219] // 12 bodů (past 2Y zjednodušeno)
      },
      {
        symbol: 'BTCUSD', name: 'Bitcoin', type: 'crypto',
        price: 67200, d1: 2.30, w1: 6.80, conf: 0.58,
        forecast: { min:42000, avg:88000, max:120000 },
        thesis: 'Poptávka přes ETF, halving + omezená nabídka, sílící narativ digitálního zlata.',
        invalid: 'Neplatí při silném risk-off, regulační restrikci či útoku na síť.',
        history: [52000,56000,59000,62000,60000,63000,65000,61000,64000,68000,66000,67200]
      },
      {
        symbol: 'NVDA', name: 'NVIDIA Corporation', type: 'stock',
        price: 241.80, d1: 1.85, w1: 4.10, conf: 0.72,
        forecast: { min:128, avg:281, max:498 },
        thesis: 'AI akceleruje poptávku, rozšíření do datacenter a edge; silná produktová roadmapa.',
        invalid: 'Neplatí při prudkém poklesu poptávky po AI capexu a zhoršení marží.',
        history: [180,194,205,198,202,216,228,235,240,232,238,242]
      }
    ];

    // ---------- Helpers ----------
    const fmt = new Intl.NumberFormat('cs-CZ');
    const fmtPct = (v)=> (v>=0?'+':'') + v.toFixed(2) + '%';
    const fmtMoney = (v)=> (v>=1000 ? fmt.format(Math.round(v)) : fmt.format(v.toFixed ? v.toFixed(2) : v));
    const by = {
      symbol: (a,b)=> a.symbol.localeCompare(b.symbol),
      name:   (a,b)=> a.name.localeCompare(b.name),
      price:  (a,b)=> a.price - b.price,
      conf:   (a,b)=> a.conf - b.conf,
    };

    // ---------- Render table ----------
    const rowsEl = document.getElementById('rows');
    function render() {
      const q = document.getElementById('q').value.trim().toLowerCase();
      const type = document.getElementById('typeFilter').value;
      const sort = document.getElementById('sortBy').value;

      const filtered = data
        .filter(x => (type==='all' || x.type===type))
        .filter(x => !q || x.symbol.toLowerCase().includes(q) || x.name.toLowerCase().includes(q))
        .sort(by[sort]);

      rowsEl.innerHTML = filtered.map(x => rowHtml(x)).join('');
    }

    function rowHtml(x){
      const f = x.forecast;
      return `
        <tr class="hover:bg-slate-50">
          <td class="px-4 py-3 font-medium text-slate-900">${x.symbol}</td>
          <td class="px-4 py-3 text-slate-700">${x.name}</td>
          <td class="px-4 py-3 text-right num">${fmtMoney(x.price)}</td>
          <td class="px-4 py-3 text-right num ${x.d1>=0?'text-emerald-600':'text-rose-600'}">${fmtPct(x.d1)}</td>
          <td class="px-4 py-3 text-right num ${x.w1>=0?'text-emerald-600':'text-rose-600'}">${fmtPct(x.w1)}</td>
          <td class="px-4 py-3 text-right num">
            ${fmtMoney(f.min)} <span class="text-slate-400">/</span>
            <b>${fmtMoney(f.avg)}</b> <span class="text-slate-400">/</span>
            ${fmtMoney(f.max)}
          </td>
          <td class="px-4 py-3 text-right num">${Math.round(x.conf*100)}%</td>
          <td class="px-4 py-3 text-right">
            <button class="pill pill-blue hover:bg-blue-100" onclick="openDetail('${x.symbol}')">Detail</button>
          </td>
        </tr>
      `;
    }

    // ---------- Modal + Chart ----------
    let chart;
    function openDetail(symbol){
      const x = data.find(d=>d.symbol===symbol);
      if(!x) return;

      document.getElementById('mTitle').textContent = `${x.symbol} — Predikce (demo)`;
      document.getElementById('mSubtitle').textContent = x.name;
      document.getElementById('mThesis').textContent = x.thesis;
      document.getElementById('mInvalid').textContent = x.invalid;
      document.getElementById('vCur').textContent = fmtMoney(x.price);
      document.getElementById('vAvg').textContent = fmtMoney(x.forecast.avg);
      document.getElementById('vMax').textContent = fmtMoney(x.forecast.max);
      document.getElementById('vMin').textContent = fmtMoney(x.forecast.min);
      document.getElementById('vConf').textContent = Math.round(x.conf*100)+'%';

      const labels = [...Array(x.history.length).keys()].map(i => ''); // skryté značky
      labels.push('Now','1Y');

      // poskládáme datasety: historie + tři „vějíře“ do 1Y
      const last = x.history[x.history.length-1];
      const datasets = [
        {
          label:'History',
          data:[...x.history, last, null],
          borderColor:'#2563eb',
          backgroundColor:'transparent',
          borderWidth:2,
          tension:0.25,
          pointRadius:0
        },
        {
          label:'Avg',
          data:[...Array(x.history.length).fill(null), last, x.forecast.avg],
          borderColor:'#10b981',
          borderWidth:2,
          pointRadius:0,
          tension:0,
        },
        {
          label:'Max',
          data:[...Array(x.history.length).fill(null), last, x.forecast.max],
          borderColor:'#10b981',
          borderDash:[6,4],
          borderWidth:2,
          pointRadius:0,
          tension:0,
        },
        {
          label:'Min',
          data:[...Array(x.history.length).fill(null), last, x.forecast.min],
          borderColor:'#ef4444',
          borderDash:[6,4],
          borderWidth:2,
          pointRadius:0,
          tension:0,
        },
      ];

      const ctx = document.getElementById('mChart').getContext('2d');
      if(chart) chart.destroy();
      chart = new Chart(ctx,{
        type:'line',
        data:{ labels, datasets },
        options:{
          responsive:true,
          maintainAspectRatio:false,
          scales:{
            x:{ display:false, grid:{display:false} },
            y:{ display:false, grid:{display:false} }
          },
          plugins:{
            legend:{ display:false },
            tooltip:{
              callbacks:{
                label: (c)=> {
                  const name = c.dataset.label;
                  return `${name}: ${fmtMoney(c.parsed.y)}`;
                }
              }
            }
          }
        }
      });

      document.getElementById('modal').classList.remove('hidden');
    }

    function closeModal(){
      document.getElementById('modal').classList.add('hidden');
    }

    // ---------- Wire up ----------
    document.getElementById('q').addEventListener('input', render);
    document.getElementById('typeFilter').addEventListener('change', render);
    document.getElementById('sortBy').addEventListener('change', render);
    render();
  </script>
</body>
</html>
