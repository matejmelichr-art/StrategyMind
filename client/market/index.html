<!doctype html>
<html lang="cs">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>StrategyMind — Market Scanner</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .card { @apply bg-white/70 backdrop-blur rounded-2xl shadow-sm ring-1 ring-black/5; }
    .pill { @apply inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-medium; }
    .muted { @apply text-slate-500; }
    .btn { @apply inline-flex items-center justify-center rounded-lg px-3 py-2 text-sm font-medium ring-1 ring-slate-300 hover:bg-slate-50; }
    .num { font-variant-numeric: tabular-nums; }
    .row-open { background-image: linear-gradient(to right, rgba(59,130,246,.05), transparent); }
    /* malý sparkline */
    .spark { width: 100%; height: 110px; }
    .spark path.line { fill: none; stroke-width: 3; }
    .spark line.dash { stroke-dasharray: 4 4; stroke-width: 3; }
  </style>
</head>
<body class="bg-slate-50 text-slate-800">
  <!-- top nav (jednotný styl) -->
  <header class="sticky top-0 z-10 bg-white/80 backdrop-blur border-b border-slate-200">
    <div class="mx-auto max-w-6xl px-4 py-3 flex items-center gap-3">
      <a href="/client/" class="btn">← Zpět na klientskou sekci</a>
      <nav class="ml-auto flex gap-2">
        <a href="/client/market/" class="btn bg-slate-900 text-white ring-slate-900 hover:bg-slate-800">Market Scanner</a>
        <a href="/client/real-estate/" class="btn">Real-Estate</a>
        <a href="/client/idea-lab/" class="btn">Idea Lab</a>
      </nav>
    </div>
  </header>

  <main class="mx-auto max-w-6xl px-4 py-8 space-y-6">
    <section class="space-y-2">
      <h1 class="text-3xl font-bold tracking-tight">Market Scanner</h1>
      <p class="muted">
        Vyhledej a filtruj akcie, indexy a krypto. Rozklikni řádek pro <em>tezi predikce</em>, podmínky <em>neplatnosti</em>
        a mini-graf s 1Y rozmezím (<strong>min / avg / max</strong>). V demu níže jsou statická data; v ostré verzi napojíme živé ceny a zprávy.
      </p>
    </section>

    <!-- filtry -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
      <input id="q" placeholder="Hledej symbol / název…" class="card w-full px-3 py-2 focus:outline-none focus:ring-2 focus:ring-slate-300" />
      <select id="type" class="card w-full px-3 py-2">
        <option value="">Všechny typy</option>
        <option>Akcie</option><option>Index</option><option>Krypto</option>
      </select>
      <select id="sort" class="card w-full px-3 py-2">
        <option value="symbol">Seřadit: Symbol</option>
        <option value="name">Seřadit: Název</option>
        <option value="price">Seřadit: Cena</option>
        <option value="w1">Seřadit: 1W %</option>
      </select>
    </div>

    <!-- tabulka -->
    <div class="card overflow-hidden">
      <table class="w-full text-sm">
        <thead class="bg-slate-100">
          <tr class="text-left text-slate-600">
            <th class="px-4 py-3">Symbol</th>
            <th class="px-4 py-3">Název</th>
            <th class="px-4 py-3">Cena</th>
            <th class="px-4 py-3">1D %</th>
            <th class="px-4 py-3">1W %</th>
            <th class="px-4 py-3">1Y predikce<br><span class="text-xs muted">(min / <b>avg</b> / max)</span></th>
            <th class="px-4 py-3">Conf.</th>
            <th class="px-4 py-3"></th>
          </tr>
        </thead>
        <tbody id="tbody" class="divide-y divide-slate-100 bg-white"></tbody>
      </table>
    </div>

    <p class="text-xs muted">* Ukázková data. V ostré verzi doplníme AI teze + zprávy + živé ceny a export reportu.</p>
  </main>

  <script>
    // ---------- Demo dataset ----------
    const DATA = [
      {
        type: 'Akcie',
        symbol: 'AAPL',
        name: 'Apple Inc.',
        price: 219.85, d1: 1.26, w1: 2.10,
        pred: { min: 165, avg: 245, max: 310, conf: 72 },
        thesis: 'Růst služeb a ekosystému, stabilní marže. Re-rating po nové produktové linii.',
        invalid: 'Breakdown pod 195 s objemy a slabý guidance.',
        history: [185,193,205,198,207,206,215,219.85]
      },
      {
        type: 'Krypto',
        symbol: 'BTCUSD',
        name: 'Bitcoin',
        price: 67200, d1: 2.30, w1: 6.80,
        pred: { min: 42000, avg: 88000, max: 120000, conf: 58 },
        thesis: 'Poptávka přes ETF, halving + omezená nabídka, sílící narativ digitálního zlata.',
        invalid: 'Regulační tlak, silný risk-off, útok na síť.',
        history: [54000,59000,61000,58000,62000,65000,67000,67200]
      },
      {
        type: 'Akcie',
        symbol: 'NVDA',
        name: 'NVIDIA Corporation',
        price: 241.80, d1: 1.85, w1: 4.10,
        pred: { min: 128, avg: 281, max: 498, conf: 72 },
        thesis: 'Růst datacenter GPU, objednávky hyperscalerů, expanze do ARM/PC.',
        invalid: 'Ochlazení poptávky po AI, exportní restrikce, problémy v supply chainu.',
        history: [190,205,198,210,215,220,235,241.8]
      }
    ];

    // ---------- Helpers ----------
    const fmt = new Intl.NumberFormat('cs-CZ');
    const pct = v => (v>=0? '+' : '') + v.toFixed(2).replace('.', ',') + '%';
    const money = v => fmt.format(v);
    const el = (t, cls='', html='') => {
      const e = document.createElement(t);
      if (cls) e.className = cls;
      if (html) e.innerHTML = html;
      return e;
    };

    // Draw tiny sparkline with dashed min/max and solid avg
    function drawSpark(container, history, pred) {
      container.innerHTML = '';
      const w = container.clientWidth || 520;
      const h = container.clientHeight || 110;
      const svg = el('svg','spark'); svg.setAttribute('viewBox', `0 0 ${w} ${h}`);

      const all = [...history, pred.max, pred.min, pred.avg];
      const minV = Math.min(...all);
      const maxV = Math.max(...all);
      const x = i => (i/(history.length-1))*(w-16)+8;
      const y = v => h - ((v - minV)/(maxV - minV))*(h-20) - 10;

      // line path
      let d = '';
      history.forEach((v,i)=>{ d += (i? 'L':'M') + x(i) + ' ' + y(v) + ' '; });
      const path = el('path'); path.setAttribute('d', d);
      path.setAttribute('class','line'); path.setAttribute('stroke','#2563eb'); // blue
      svg.appendChild(path);

      // dashed min / max on the right edge + solid avg
      const xr = w - 10;
      const lMax = el('line'); lMax.setAttribute('x1', xr); lMax.setAttribute('x2', xr);
      lMax.setAttribute('y1', y(pred.max)); lMax.setAttribute('y2', y(history.at(-1)));
      lMax.setAttribute('class','dash'); lMax.setAttribute('stroke','#16a34a'); // green
      svg.appendChild(lMax);

      const lMin = el('line'); lMin.setAttribute('x1', xr+8); lMin.setAttribute('x2', xr+8);
      lMin.setAttribute('y1', y(pred.min)); lMin.setAttribute('y2', y(history.at(-1)));
      lMin.setAttribute('class','dash'); lMin.setAttribute('stroke','#ef4444'); // red
      svg.appendChild(lMin);

      const lAvg = el('line'); lAvg.setAttribute('x1', xr-8); lAvg.setAttribute('x2', xr-8);
      lAvg.setAttribute('y1', y(pred.avg)); lAvg.setAttribute('y2', y(history.at(-1)));
      lAvg.setAttribute('stroke','#0ea5e9'); lAvg.setAttribute('stroke-width','3'); // solid cyan
      svg.appendChild(lAvg);

      container.appendChild(svg);
    }

    // ---------- Render table ----------
    const tbody = document.getElementById('tbody');

    function render(rows){
      tbody.innerHTML = '';
      rows.forEach((r, idx) => {
        // main row
        const tr = el('tr','hover:bg-slate-50');
        tr.innerHTML = `
          <td class="px-4 py-3 font-semibold">${r.symbol}</td>
          <td class="px-4 py-3">${r.name}</td>
          <td class="px-4 py-3 num">${money(r.price)}</td>
          <td class="px-4 py-3"><span class="num ${r.d1>=0?'text-emerald-600':'text-rose-600'}">${pct(r.d1)}</span></td>
          <td class="px-4 py-3"><span class="num ${r.w1>=0?'text-emerald-600':'text-rose-600'}">${pct(r.w1)}</span></td>
          <td class="px-4 py-3 num">
            ${money(r.pred.min)} <span class="muted">/</span>
            <b>${money(r.pred.avg)}</b> <span class="muted">/</span>
            ${money(r.pred.max)}
          </td>
          <td class="px-4 py-3"><span class="pill bg-emerald-50 text-emerald-700 ring-1 ring-emerald-200">${r.pred.conf}%</span></td>
          <td class="px-4 py-3 text-right">
            <button class="btn" data-toggle="${idx}">Detail</button>
          </td>
        `;
        tbody.appendChild(tr);

        // detail row (hidden)
        const dtr = el('tr'); dtr.classList.add('hidden'); dtr.id = `detail-${idx}`;
        const td = el('td','px-4 py-4 bg-slate-50/60 row-open', ''); td.colSpan = 8;

        const box = el('div','grid grid-cols-1 md:grid-cols-2 gap-6 items-start');
        // left – text
        const left = el('div','space-y-3');
        left.innerHTML = `
          <div><span class="pill bg-slate-100 ring-1 ring-slate-200 mr-2">Teze</span><span>${r.thesis}</span></div>
          <div><span class="pill bg-slate-100 ring-1 ring-slate-200 mr-2">Neplatí, pokud</span><span>${r.invalid}</span></div>
          <div class="muted text-xs">* Demo sparkline z ukázkových dat. Čárkovaně min/max, plná čára avg.</div>
        `;
        // right – sparkline + štítky
        const right = el('div','card p-3');
        right.innerHTML = `
          <div class="flex items-center justify-between mb-2">
            <div class="font-medium">${r.symbol} — mini-graf</div>
            <div class="muted text-xs">1Y range</div>
          </div>
          <div class="w-full spark-box"><div class="spark"></div></div>
          <div class="mt-3 grid grid-cols-2 gap-2 text-xs">
            <div class="flex items-center gap-2"><span class="w-2 h-2 rounded-full bg-sky-500"></span>Avg: <b class="num">${money(r.pred.avg)}</b></div>
            <div class="flex items-center gap-2"><span class="w-2 h-2 rounded-full bg-emerald-500"></span>Max: <span class="num">${money(r.pred.max)}</span></div>
            <div class="flex items-center gap-2"><span class="w-2 h-2 rounded-full bg-rose-500"></span>Min: <span class="num">${money(r.pred.min)}</span></div>
            <div class="flex items-center gap-2"><span class="w-2 h-2 rounded-full bg-blue-600"></span>Aktuální: <span class="num">${money(r.price)}</span></div>
          </div>
        `;
        box.appendChild(left); box.appendChild(right);
        td.appendChild(box); dtr.appendChild(td);
        tbody.appendChild(dtr);

        // toggle
        tr.querySelector('[data-toggle]').addEventListener('click', () => {
          // zavři ostatní
          document.querySelectorAll('tr[id^="detail-"]').forEach(x => {
            if (x !== dtr) x.classList.add('hidden');
          });
          dtr.classList.toggle('hidden');
          if (!dtr.classList.contains('hidden')) {
            const svgHost = dtr.querySelector('.spark');
            drawSpark(svgHost, r.history, r.pred);
          }
        });
      });
    }

    // init + jednoduché filtrování/řazení
    let rows = [...DATA];

    function apply() {
      const q = document.getElementById('q').value.trim().toLowerCase();
      const type = document.getElementById('type').value;
      const sort = document.getElementById('sort').value;

      rows = DATA.filter(r =>
        (!type || r.type === type) &&
        (!q || r.symbol.toLowerCase().includes(q) || r.name.toLowerCase().includes(q))
      );
      rows.sort((a,b)=>{
        if (sort==='name') return a.name.localeCompare(b.name);
        if (sort==='price') return a.price-b.price;
        if (sort==='w1') return b.w1-a.w1;
        return a.symbol.localeCompare(b.symbol);
      });
      render(rows);
    }

    document.getElementById('q').addEventListener('input', apply);
    document.getElementById('type').addEventListener('change', apply);
    document.getElementById('sort').addEventListener('change', apply);
    apply();
  </script>
</body>
</html>
