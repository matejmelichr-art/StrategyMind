<!doctype html>
<html lang="cs">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>StrategyMind — Market Scanner (demo)</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-50 text-slate-800">
  <header class="sticky top-0 z-10 bg-white/90 backdrop-blur border-b">
    <div class="max-w-6xl mx-auto px-4 py-3 flex items-center gap-3">
      <a href="/client/" class="text-sm px-3 py-1.5 rounded-lg border hover:bg-slate-50">← Zpět na klientskou sekci</a>
      <nav class="ml-auto flex gap-2">
        <a class="px-3 py-1.5 rounded-full text-sm bg-slate-900 text-white">Market Scanner</a>
        <a class="px-3 py-1.5 rounded-full text-sm bg-slate-100 hover:bg-slate-200" href="/client/">Real-Estate</a>
        <a class="px-3 py-1.5 rounded-full text-sm bg-slate-100 hover:bg-slate-200" href="/client/">Idea Lab</a>
      </nav>
    </div>
  </header>

  <main class="max-w-6xl mx-auto px-4 py-8">
    <div class="flex items-start gap-4 mb-6">
      <h1 class="text-2xl md:text-3xl font-semibold">Market Scanner</h1>
      <span class="text-slate-500 mt-1">— rozklikni řádek pro detail predikce</span>
      <a href="#" class="ml-auto inline-flex items-center gap-2 px-4 py-2 rounded-lg bg-slate-900 text-white text-sm hover:bg-slate-800">
        Stáhnout report (MD)
      </a>
    </div>

    <!-- Filtřík (demo) -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-3 mb-5">
      <input id="q" placeholder="Hledat symbol / název…" class="w-full px-3 py-2 rounded-lg border outline-none focus:ring-2 focus:ring-slate-300" />
      <select class="w-full px-3 py-2 rounded-lg border">
        <option>Všechny typy</option>
        <option>Akcie</option><option>Krypto</option><option>Indexy</option>
      </select>
      <select class="w-full px-3 py-2 rounded-lg border">
        <option>Seřadit: Symbol</option>
        <option>Seřadit: 1Y avg</option>
        <option>Seřadit: Confidence</option>
      </select>
    </div>

    <!-- Tabulka -->
    <div class="overflow-hidden rounded-2xl border bg-white">
      <table class="w-full text-sm">
        <thead class="bg-slate-50 border-b">
          <tr class="text-left">
            <th class="px-4 py-3">Symbol</th>
            <th class="px-4 py-3">Název</th>
            <th class="px-4 py-3">Cena</th>
            <th class="px-4 py-3">1D %</th>
            <th class="px-4 py-3">1W %</th>
            <th class="px-4 py-3">1Y predikce (min/avg/max)</th>
            <th class="px-4 py-3">Conf.</th>
            <th class="px-4 py-3"></th>
          </tr>
        </thead>
        <tbody id="rows" class="divide-y">
          <!-- Řádky se doplní JS níže -->
        </tbody>
      </table>
    </div>
  </main>

  <script>
    /**
     * Vykreslí „vějíř“ predikce do zadaného kontejneru pomocí čistého SVG.
     * - history: [čísla] — historické hodnoty (poslední bod = start predikce)
     * - forecast: {min:[…], avg:[…], max:[…]} — 3 trajektorie o stejné délce
     */
    function renderForecastSparkline(container, history, forecast, opts = {}) {
      const width  = opts.width  ?? 430;
      const height = opts.height ?? 200;
      const pad    = 22;

      const allVals = [...history, ...forecast.min, ...forecast.avg, ...forecast.max];
      const minV = Math.min(...allVals);
      const maxV = Math.max(...allVals);

      const nHist = history.length;
      const nFor  = forecast.avg.length;
      const total = nHist + nFor;

      // škálování
      const x = i => pad + (i/(total-1)) * (width - 2*pad);
      const y = v => pad + (1 - (v - minV)/(maxV - minV || 1)) * (height - 2*pad);

      // pomůcky
      const linePath = (arr, xOffset=0) =>
        arr.map((v,i)=>`${i?'L':'M'}${x(i+xOffset).toFixed(1)},${y(v).toFixed(1)}`).join(' ');

      // polygon pásma min-max
      const bandPoints = [
        ...forecast.min.map((v,i)=>`${x(nHist+i).toFixed(1)},${y(v).toFixed(1)}`),
        ...forecast.max.map((v,i)=>`${x(nHist + (nFor-1-i)).toFixed(1)},${y(forecast.max[nFor-1-i]).toFixed(1)}`)
      ].join(' ');

      // SVG
      container.innerHTML = `
        <svg viewBox="0 0 ${width} ${height}" width="${width}" height="${height}" class="w-full h-auto">
          <!-- pozadí -->
          <rect x="0" y="0" width="${width}" height="${height}" rx="18" class="fill-white"/>
          <rect x="${pad-10}" y="${pad-10}" width="${width-2*(pad-10)}" height="${height-2*(pad-10)}" rx="14" class="fill-slate-50"/>

          <!-- pásmo min-max (vějíř) -->
          <polygon points="${bandPoints}" fill="rgba(16,185,129,0.12)"></polygon>

          <!-- čárkovaná svislice = start predikce -->
          <line x1="${x(nHist)}" y1="${pad}" x2="${x(nHist)}" y2="${height-pad}"
                stroke="#94a3b8" stroke-dasharray="4 4" stroke-width="1"/>

          <!-- historie (plná modrá) -->
          <path d="${linePath(history,0)}" fill="none" stroke="#2563eb" stroke-width="2.5"/>

          <!-- predikce avg (plná tmavě zelená) -->
          <path d="M${x(nHist).toFixed(1)},${y(history[nHist-1]).toFixed(1)} ${linePath(forecast.avg,0)}"
                fill="none" stroke="#059669" stroke-width="2.5"/>

          <!-- predikce min/max (čárkované) -->
          <path d="M${x(nHist).toFixed(1)},${y(history[nHist-1]).toFixed(1)} ${linePath(forecast.min,0)}"
                fill="none" stroke="#ef4444" stroke-width="2" stroke-dasharray="6 4"/>
          <path d="M${x(nHist).toFixed(1)},${y(history[nHist-1]).toFixed(1)} ${linePath(forecast.max,0)}"
                fill="none" stroke="#10b981" stroke-width="2" stroke-dasharray="6 4"/>

          <!-- štuplíky na konci a štítky -->
          ${(() => {
            const lx = x(total-1);
            const lyMin = y(forecast.min[nFor-1]);
            const lyAvg = y(forecast.avg[nFor-1]);
            const lyMax = y(forecast.max[nFor-1]);
            return `
              <circle cx="${lx}" cy="${lyAvg}" r="3.5" fill="#059669"/>
              <circle cx="${lx}" cy="${lyMin}" r="3" fill="#ef4444"/>
              <circle cx="${lx}" cy="${lyMax}" r="3" fill="#10b981"/>

              <g font-size="10" font-family="ui-sans-serif,system-ui">
                <text x="${lx+8}" y="${lyAvg+3}" fill="#065f46">Avg</text>
                <text x="${lx+8}" y="${lyMax+3}" fill="#065f46">Max</text>
                <text x="${lx+8}" y="${lyMin+3}" fill="#991b1b">Min</text>
              </g>
            `;
          })()}
        </svg>
      `;
    }

    // --- DEMO DATA ----------------------------------------------------------
    const demoRows = [
      {
        symbol: "AAPL", name: "Apple Inc.", price: "219,85", d1:"+1.26%", w1:"+2.10%",
        forecast: {min:165, avg:245, max:310}, conf:"72%",
        history: [180,186,191,188,195,201,198,205,208,215,212,220],
        fan: {
          min:[190,185,180,175,170,165],
          avg:[222,228,232,238,241,245],
          max:[230,245,262,280,296,310],
        },
        bull:"Růst služeb a ekosystému, stabilní marže. Re-rating po nové produktové linii.",
        bear:"Neplatí pokud: breakdown pod 195 s objemy a slabý guidance."
      },
      {
        symbol:"BTCUSD", name:"Bitcoin", price:"67 200", d1:"+2.30%", w1:"+6.80%",
        forecast:{min:42000, avg:88000, max:120000}, conf:"58%",
        history:[52000,56000,58000,54000,57000,62000,60000,64000,63000,65000,66000,67200],
        fan:{
          min:[60000,56000,52000,48000,45000,42000],
          avg:[70000,76000,80000,84000,86000,88000],
          max:[82000,90000,98000,106000,113000,120000]
        },
        bull:"Poptávka přes ETF, halving + omezená nabídka, sílící narativ digitálního zlata.",
        bear:"Neplatí pokud: regulační tlak, silný risk-off, útok na síť."
      }
    ];

    // --- Sestavení řádků ----------------------------------------------------
    const tbody = document.getElementById('rows');

    demoRows.forEach((r, idx) => {
      const tr = document.createElement('tr');
      tr.className = "align-top hover:bg-slate-50/80";
      tr.innerHTML = `
        <td class="px-4 py-3 font-semibold">${r.symbol}</td>
        <td class="px-4 py-3">${r.name}</td>
        <td class="px-4 py-3">${r.price}</td>
        <td class="px-4 py-3 text-emerald-600">${r.d1}</td>
        <td class="px-4 py-3 text-emerald-600">${r.w1}</td>
        <td class="px-4 py-3">
          <div class="text-slate-500 text-[13px] mb-2">
            ${r.forecast.min} / <span class="font-semibold text-slate-800">${r.forecast.avg}</span> / ${r.forecast.max}
          </div>
          <div id="spark-${idx}" class="rounded-2xl border overflow-hidden bg-white"></div>
          <div class="mt-2 text-[11px] text-slate-400">* Čárkovaně min/max, plná čára průměr. Vertikální čára = start predikce (demo).</div>
        </td>
        <td class="px-4 py-3">${r.conf}</td>
        <td class="px-4 py-3">
          <button class="px-3 py-1.5 rounded-lg border hover:bg-slate-100 text-slate-700">Detail</button>
        </td>
      `;
      tbody.appendChild(tr);

      // „podřádek“ s tezí/bear podmínkou
      const tr2 = document.createElement('tr');
      tr2.className = "bg-white";
      tr2.innerHTML = `
        <td></td>
        <td colspan="6" class="px-4 pb-5">
          <div class="mt-3 flex flex-col gap-1 text-[13px]">
            <div><span class="inline-block px-2 py-0.5 rounded-full bg-slate-100 border mr-2">Teze</span>${r.bull}</div>
            <div class="text-slate-500"><span class="inline-block px-2 py-0.5 rounded-full bg-slate-100 border mr-2">Neplatí pokud</span>${r.bear}</div>
          </div>
        </td>
        <td></td>
      `;
      tbody.appendChild(tr2);

      // vykresli SVG vějíř
      renderForecastSparkline(
        document.getElementById(`spark-${idx}`),
        r.history,
        r.fan,
        { width: 450, height: 220 }
      );
    });

    // jednoduché vyhledávání (demo)
    document.getElementById('q').addEventListener('input', (e)=>{
      const q = e.target.value.toLowerCase();
      [...tbody.querySelectorAll('tr')].forEach(tr=>{
        if (tr.children.length < 8) return; // přeskoč „podřádky“
        const sym = tr.children[0].textContent.toLowerCase();
        const name= tr.children[1].textContent.toLowerCase();
        tr.style.display = (sym.includes(q) || name.includes(q)) ? '' : 'none';
        const next = tr.nextElementSibling;
        if (next) next.style.display = tr.style.display;
      });
    });
  </script>
</body>
</html>
