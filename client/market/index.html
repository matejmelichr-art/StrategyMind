<!doctype html>
<html lang="cs">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>StrategyMind — Market Scanner</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com?plugins=forms"></script>

  <style>
    html,body{font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial}
    .row:hover{background:#f8fafc}
    .pill{padding:.375rem .625rem;border-radius:9999px;border:1px solid rgba(15,23,42,.08)}
    .kbd{background:#f3f4f6;padding:.125rem .375rem;border-radius:.25rem;font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Courier New",monospace;font-size:.75rem}

    /* mini-graf */
    .spark path.avg{stroke:#2563eb;stroke-width:2;fill:none}
    .spark path.min,.spark path.max{stroke-width:2;fill:none;stroke-dasharray:4 4}
    .spark path.min{stroke:#ef4444}.spark path.max{stroke:#22c55e}
    .spark line.guide{stroke:#94a3b8;stroke-dasharray:4 4;opacity:.6}
    .spark-wrap{display:flex;align-items:center;gap:.75rem}
    .target-badges{display:flex;flex-direction:column;gap:.2rem;font-size:.75rem;line-height:1.1}
    .target-badges .b{display:flex;align-items:center;gap:.4rem;white-space:nowrap}
    .dot{width:.5rem;height:.5rem;border-radius:9999px;display:inline-block}
    .dot.max{background:#22c55e}.dot.avg{background:#2563eb}.dot.min{background:#ef4444}

    /* AI Edge panel */
    .overlay{background:rgba(2,6,23,.45)}
    .fade-enter{opacity:0;transform:translateY(6px)}
    .fade-enter-active{opacity:1;transform:none;transition:all .18s ease}
    .drop-active{border-color:#0ea5e9 !important;background:rgba(14,165,233,.05)}

    /* tabulka – širší fixní sloupce pro Conf. a Akce + nowrap */
    .table-grid{
      display:grid;
      grid-template-columns: 100px 1fr 120px 100px 100px 250px 80px 180px; /* poslední dva sloupce širší */
      align-items:center;
    }
    .cell-nowrap{white-space:nowrap}
    .actions{display:flex;justify-content:flex-end;gap:.5rem}
    @media (max-width: 1180px){
      /* na tabletech: místo „Detail“ necháme jen AI predikce, Akce rozšíříme */
      .table-grid{
        grid-template-columns: 90px 1fr 110px 95px 95px 260px 80px 190px;
      }
      .btn-detail{display:none}             /* skryj detail, ať nic nevadí */
    }
  </style>
</head>
<body class="bg-slate-50 text-slate-900">
  <!-- Header -->
  <header class="sticky top-0 z-20 backdrop-blur bg-white/80 border-b border-slate-200">
    <div class="max-w-6xl mx-auto px-4 py-3 flex items-center gap-3">
      <a href="/client/" class="text-sm text-slate-600 hover:text-slate-900 flex items-center gap-2">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" class="opacity-70"><path d="M15 6l-6 6 6 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
        Zpět na klientskou sekci
      </a>
      <div class="ml-auto flex flex-wrap items-center gap-2 overflow-x-auto">
        <a href="/client/market/" class="pill bg-white font-medium whitespace-nowrap">Market Scanner</a>
        <a href="/client/real-estate/" class="pill whitespace-nowrap">Real-Estate</a>
        <a href="/client/idea-lab/" class="pill whitespace-nowrap">Idea Lab</a>
        <span class="ml-2 text-xs text-slate-500 border border-slate-200 rounded-full px-2 py-1 select-none whitespace-nowrap">v2</span>
      </div>
    </div>
  </header>

  <main class="max-w-6xl mx-auto px-4 py-8">
    <div class="flex items-start flex-wrap gap-3 justify-between">
      <div>
        <h1 class="text-3xl font-semibold tracking-tight">Market Scanner</h1>
        <p class="mt-2 text-slate-600 max-w-3xl">
          Vyhledej a filtruj akcie, indexy, forex, krypto a komodity.
          Řádek <strong>rozklikni</strong> pro tezi, podmínky neplatnosti a <strong>mini-graf</strong>
          s 1Y rozmezím (<em>min / avg / max</em>) + štítky cílových hodnot.
        </p>
      </div>

      <div class="w-full md:w-auto">
        <button id="openAIEdgeTop" class="w-full md:w-auto inline-flex items-center gap-2 px-4 py-2 rounded-xl bg-cyan-600 text-white shadow-sm hover:bg-cyan-700">
          ⚡ AI Edge — Osobní predikce
        </button>
        <div class="text-xs text-slate-500 mt-1 md:text-right">Nahrát screenshot nebo zadat symbol. Okamžitý směr + úrovně + důvody.</div>
      </div>
    </div>

    <!-- Toolbar -->
    <div class="mt-6 grid grid-cols-1 md:grid-cols-4 gap-3">
      <div class="relative md:col-span-2">
        <input id="q" class="w-full px-3 py-2 rounded-lg border border-slate-200 bg-white outline-none focus:ring-2 focus:ring-slate-200" placeholder="Hledej symbol / název…" />
        <div class="absolute inset-y-0 right-2 flex items-center text-slate-400 pointer-events-none"><span class="kbd">/</span></div>
      </div>
      <select id="typeFilter" class="w-full px-3 py-2 rounded-lg border border-slate-200 bg-white outline-none focus:ring-2 focus:ring-slate-200">
        <option value="">Všechny typy</option><option value="stock">Akcie</option><option value="crypto">Krypto</option><option value="index">Index</option><option value="forex">Forex</option><option value="commodity">Komodita</option>
      </select>
      <select id="sortBy" class="w-full px-3 py-2 rounded-lg border border-slate-200 bg-white outline-none focus:ring-2 focus:ring-slate-200">
        <option value="symbol">Seřadit: Symbol</option><option value="price">Seřadit: Cena</option><option value="w1">Seřadit: 1W %</option><option value="conf">Seřadit: Confidence</option>
      </select>
    </div>

    <!-- Table (scroll wrapper) -->
    <div class="mt-5 overflow-x-auto">
      <div class="min-w-[980px] overflow-hidden rounded-2xl border border-slate-200 bg-white shadow-sm">
        <!-- head -->
        <div class="table-grid px-4 py-2 text-sm font-medium text-slate-500 bg-slate-50">
          <div>Symbol</div>
          <div>Název</div>
          <div class="text-right">Cena</div>
          <div class="text-right">1D %</div>
          <div class="text-right">1W %</div>
          <div class="text-center">1Y predikce <span class="text-slate-400">(min / avg / max)</span></div>
          <div class="text-right">Conf.</div>
          <div class="text-right">Akce</div>
        </div>
        <div id="rows"></div>
      </div>
    </div>

    <p class="mt-3 text-xs text-slate-500">* Demo verze se statickými daty. V ostré verzi připojíme AI teze + zprávy + živé ceny.</p>
  </main>

  <!-- ============== AI EDGE PANEL ============== -->
  <div id="edgeOverlay" class="hidden fixed inset-0 z-50 overlay"></div>
  <section id="edgePanel" class="hidden fixed inset-0 z-50 p-4 md:p-8 overflow-y-auto">
    <div class="fade-enter max-w-5xl mx-auto rounded-2xl border border-slate-200 bg-white shadow-lg overflow-hidden">
      <div class="px-5 py-4 flex items-center justify-between bg-slate-50 border-b border-slate-200">
        <div class="flex items-center gap-3">
          <span class="inline-flex h-8 w-8 items-center justify-center rounded-lg bg-cyan-600 text-white">⚡</span>
          <div><h2 class="text-lg font-semibold">AI Edge — Osobní predikce</h2><div class="text-xs text-slate-500">Symbol: <b id="edgeSymbolLabel">—</b></div></div>
        </div>
        <button id="edgeClose" class="px-3 py-1.5 rounded-lg border border-slate-300 hover:bg-slate-100">Zavřít</button>
      </div>

      <div class="p-5 grid lg:grid-cols-2 gap-6">
        <div>
          <label class="text-sm font-medium text-slate-600">Symbol (nebo nech předvyplněný)</label>
          <input id="edgeSymbol" class="mt-1 w-full px-3 py-2 rounded-lg border border-slate-200" placeholder="AAPL, NVDA, BTCUSD…" />

          <label class="mt-4 block text-sm font-medium text-slate-600">Screenshot grafu (volitelně: PNG/JPG nebo PDF)</label>
          <div id="edgeDrop" class="mt-2 rounded-xl border border-dashed border-slate-300 p-6 text-center cursor-pointer">
            <input id="edgeFile" type="file" accept="image/*,.pdf" class="hidden" />
            <p class="text-slate-500">Přetáhni sem soubor nebo <span class="text-cyan-700 underline">vyber</span></p>
            <p class="mt-1 text-xs text-slate-400">Max ~10 MB</p>
            <img id="edgePreview" class="hidden mt-4 max-h-56 mx-auto rounded-lg border border-slate-200" alt="Náhled" />
            <canvas id="edgeCanvas" class="hidden"></canvas>
          </div>

          <label class="mt-4 block text-sm font-medium text-slate-600">Poznámka / úmysl (volitelně)</label>
          <textarea id="edgeNote" rows="3" class="mt-2 w-full rounded-lg border border-slate-300 p-3" placeholder="Např.: Hledám breakout nad 245 s targetem 310 a SL 195…"></textarea>

          <div class="mt-3 flex items-center gap-4">
            <label class="inline-flex items-center gap-2 text-sm"><input id="edgeUseWeb" type="checkbox" class="rounded border-slate-300 text-cyan-600 focus:ring-cyan-500">Prohledat web (zprávy, earnings, sentiment)</label>
            <label class="inline-flex items-center gap-2 text-sm"><input id="edgeExplain" type="checkbox" class="rounded border-slate-300 text-cyan-600 focus:ring-cyan-500" checked>Vysvětlit klíčové úrovně</label>
          </div>

          <div class="mt-4 flex items-center gap-3">
            <button id="edgeRun" class="px-4 py-2 rounded-xl bg-cyan-600 text-white hover:bg-cyan-700 shadow-sm disabled:opacity-60 disabled:cursor-not-allowed">Spustit AI predikci</button>
            <button id="edgeClear" class="px-3 py-2 rounded-xl border border-slate-300 hover:bg-slate-100">Vyčistit</button>
          </div>

          <p class="mt-3 text-xs text-slate-500">Backend API: <code>POST /api/trader-ai/analyze</code> (multipart). Pokud není dostupné, zapne se demo-mock.</p>
        </div>

        <div>
          <div class="flex items-center justify-between"><h3 class="text-sm font-semibold text-slate-600">Výstup</h3><button id="edgeSave" class="text-sm px-3 py-1.5 rounded-lg border border-slate-300 hover:bg-slate-100" disabled>Uložit</button></div>
          <div id="edgeResult" class="mt-2 rounded-xl border border-slate-200 p-4 min-h-[220px]"><p class="text-slate-500 text-sm">Zatím nic. Zadej symbol nebo nahraj graf a spusť AI.</p></div>
          <h4 class="mt-6 text-sm font-semibold text-slate-600">Historie (lokálně)</h4>
          <div id="edgeHistory" class="mt-2 space-y-2 text-sm"></div>
        </div>
      </div>
    </div>
  </section>
  <!-- ============== /AI EDGE PANEL ============== -->

  <noscript><div class="max-w-6xl mx-auto px-4 py-6 text-rose-700">Pro zobrazení dat povol JavaScript.</div></noscript>

  <script>
  window.addEventListener('DOMContentLoaded', function(){
    // ===== helpers =====
    var fmt = new Intl.NumberFormat('cs-CZ',{maximumFractionDigits:2});
    function pct(v){ return (v>=0?'+':'') + v.toFixed(2) + '%'; }

    var rows = [
      {type:'stock',symbol:'AAPL',name:'Apple Inc.',price:219.85,d1:1.26,w1:2.10,forecast:{min:165,avg:245,max:310,conf:72},thesis:'Růst služeb a ekosystému, stabilní marže. Re-rating po nové produktové linii.',invalid:'Breakdown pod 195 s objemy a slabá guidance.',path:{avg:[0,1,1.8,1.4,2.1,2.0,2.5],min:[0,-0.5,-0.2,-0.7,-0.4,-0.8,-1.1],max:[0,1.6,2.3,1.9,2.7,2.5,3.1]}},
      {type:'crypto',symbol:'BTCUSD',name:'Bitcoin',price:67200,d1:2.30,w1:6.80,forecast:{min:42000,avg:88000,max:120000,conf:58},thesis:'Poptávka přes ETF, halving + omezená nabídka, sílící narativ „digitální zlato“.',invalid:'Regulační tlak, silný risk-off, útok na síť.',path:{avg:[0,1.1,1.0,1.3,1.45,1.42,1.55],min:[0,0.2,0.1,0.15,0.1,0.05,0],max:[0,1.7,1.9,2.2,2.4,2.5,2.8]}},
      {type:'stock',symbol:'NVDA',name:'NVIDIA Corporation',price:241.80,d1:1.85,w1:4.10,forecast:{min:128,avg:281,max:498,conf:72},thesis:'Udržitelná poptávka po AI akcelerátorech, expanze do datacenter a softwaru.',invalid:'Cyklus investic do DC se zpomalí, regulace vývozu čipů.',path:{avg:[0,0.6,0.9,0.7,1.2,1.6,1.9],min:[0,-0.3,-0.4,-0.5,-0.7,-0.8,-1.0],max:[0,1.2,1.6,1.5,2.0,2.6,3.0]}}
    ];

    var container = document.getElementById('rows');

    function pathFrom(points,width, height, pad){
      width = width||220; height = height||72; pad = pad||4;
      var max=1, i; for(i=0;i<points.length;i++){ var a=Math.abs(points[i]); if(a>max) max=a; }
      var step=(width-pad*2)/(points.length-1);
      function scaleY(v){ return (height/2 - (v/max)*(height/2 - pad)); }
      function scaleX(i){ return pad + i*step; }
      var d='', x,y; for(i=0;i<points.length;i++){ x=scaleX(i); y=scaleY(points[i]); d+=(i===0?('M'+x+','+y):(' L'+x+','+y)); }
      return d;
    }

    function sparkSVG(series,forecast){
      var w=220,h=72,pad=4;
      var dAvg=pathFrom(series.avg,w,h,pad);
      var dMin=pathFrom(series.min,w,h,pad);
      var dMax=pathFrom(series.max,w,h,pad);
      var step=(w-pad*2)/(series.avg.length-1);
      var guideX=pad+step*(series.avg.length-1);
      return '<div class="spark-wrap">'
        + '<svg width="'+w+'" height="'+h+'" viewBox="0 0 '+w+' '+h+'" class="spark">'
        +   '<line class="guide" x1="'+guideX+'" y1="0" x2="'+guideX+'" y2="'+h+'"></line>'
        +   '<path class="min" d="'+dMin+'"></path>'
        +   '<path class="max" d="'+dMax+'"></path>'
        +   '<path class="avg" d="'+dAvg+'"></path>'
        + '</svg>'
        + '<div class="target-badges">'
        +   '<div class="b"><span class="dot max"></span><span>Max</span><strong>'+fmt.format(forecast.max)+'</strong></div>'
        +   '<div class="b"><span class="dot avg"></span><span>Avg</span><strong>'+fmt.format(forecast.avg)+'</strong></div>'
        +   '<div class="b"><span class="dot min"></span><span>Min</span><strong>'+fmt.format(forecast.min)+'</strong></div>'
        + '</div></div>';
    }

    function renderRow(r){
      var row=document.createElement('div'); row.className="row border-t border-slate-100";
      row.innerHTML =
        '<div class="table-grid px-4 py-3 cursor-pointer">'
        +  '<div class="font-semibold cell-nowrap">'+r.symbol+'</div>'
        +  '<div class="text-slate-700 truncate">'+r.name+'</div>'
        +  '<div class="text-right tabular-nums cell-nowrap">'+fmt.format(r.price)+'</div>'
        +  '<div class="text-right tabular-nums cell-nowrap '+(r.d1>=0?'text-emerald-600':'text-rose-600')+'">'+pct(r.d1)+'</div>'
        +  '<div class="text-right tabular-nums cell-nowrap '+(r.w1>=0?'text-emerald-600':'text-rose-600')+'">'+pct(r.w1)+'</div>'
        +  '<div class="text-center tabular-nums cell-nowrap text-[15px]">'+fmt.format(r.forecast.min)+' / <span class="font-semibold">'+fmt.format(r.forecast.avg)+'</span> / '+fmt.format(r.forecast.max)+'</div>'
        +  '<div class="text-right tabular-nums cell-nowrap">'+r.forecast.conf+'%</div>'
        +  '<div class="actions cell-nowrap">'
        +    '<button class="btn-detail px-3 py-1.5 text-sm rounded-lg border border-slate-200 hover:bg-slate-50">Detail</button>'
        +    '<button class="px-3 py-1.5 text-sm rounded-lg bg-cyan-600 text-white hover:bg-cyan-700 min-w-[120px]">AI predikce</button>'
        +  '</div>'
        +'</div>'
        +'<div class="hidden px-4 pb-4">'
        +  '<div class="grid md:grid-cols-[300px,1fr,1fr] gap-6 mt-3 rounded-xl border border-slate-100 bg-slate-50 p-4">'
        +    '<div>'
        +      '<div class="text-xs text-slate-500 mb-1">Mini-graf — 1Y (demo)</div>'
        +      '<div class="rounded-lg border border-slate-200 bg-white p-2">'+sparkSVG(r.path,r.forecast)+'</div>'
        +      '<div class="mt-1 text-[11px] text-slate-500">Plná čára: <b>avg</b> · čárkovaně: <b>min/max</b> · tečkovaná: <b>dnes</b></div>'
        +    '</div>'
        +    '<div class="text-sm"><div class="text-slate-500 mb-1">Teze</div><div class="bg-white border border-slate-200 rounded-lg p-3">'+r.thesis+'</div></div>'
        +    '<div class="text-sm"><div class="text-slate-500 mb-1">Neplatí, pokud</div><div class="bg-white border border-slate-200 rounded-lg p-3">'+r.invalid+'</div><div class="mt-3 text-xs text-slate-500">*Ukázková data, demo verze.</div></div>'
        +  '</div>'
        +'</div>';

      var head=row.querySelector('.table-grid');
      var detailBtn=row.querySelector('.btn-detail');
      var panel=row.children[1];
      function toggle(){ panel.classList.toggle('hidden'); }
      head.addEventListener('click', function(e){ if(e.target.tagName.toLowerCase()==='button') return; toggle(); });
      if(detailBtn){ detailBtn.addEventListener('click', function(e){ e.stopPropagation(); toggle(); }); }
      container.appendChild(row);
    }

    function render(list){ container.innerHTML=''; for(var i=0;i<list.length;i++) renderRow(list[i]); }

    var q=document.getElementById('q'), typeFilter=document.getElementById('typeFilter'), sortBy=document.getElementById('sortBy');

    function apply(){
      var term=(q.value||'').trim().toLowerCase();
      var out = rows.filter(function(r){
        var okType = !typeFilter.value || r.type===typeFilter.value;
        var okSearch = !term || r.symbol.toLowerCase().indexOf(term)>=0 || r.name.toLowerCase().indexOf(term)>=0;
        return okType && okSearch;
      });
      switch(sortBy.value){
        case 'price': out.sort(function(a,b){return b.price-a.price}); break;
        case 'w1':    out.sort(function(a,b){return b.w1-a.w1});     break;
        case 'conf':  out.sort(function(a,b){return b.forecast.conf-a.forecast.conf}); break;
        default:      out.sort(function(a,b){return a.symbol.localeCompare(b.symbol)});
      }
      render(out);
    }
    q.addEventListener('input',apply);
    typeFilter.addEventListener('change',apply);
    sortBy.addEventListener('change',apply);
    document.addEventListener('keydown',function(e){ if(e.key==='/'){ e.preventDefault(); q.focus(); }});
    apply();
  });
  </script>
</body>
</html>
