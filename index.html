<!doctype html>
<html lang="cs" dir="auto">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>StrategyMind — Live data, zprávy, trhy, akademie</title>

  <!-- Meta / ikony -->
  <link rel="icon" type="image/png" href="logo.png"/>
  <meta property="og:title" content="StrategyMind — Live data, zprávy a trhy"/>
  <meta property="og:image" content="logo.png"/>
  <meta name="twitter:card" content="summary_large_image"/>

  <!-- Tailwind (CDN) -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: { brand:'#0A2342', mint:'#2bd4a9', ink:'#0f172a' },
          boxShadow: { soft:'0 20px 60px -20px rgba(2,6,23,.12)' },
          borderRadius: { xl2:'1.25rem' }
        }
      }
    }
  </script>
  <style>
    html{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}
    .btn{ @apply rounded-xl px-4 py-2 text-sm font-semibold transition; }
    .btn-brand{ @apply bg-brand text-white shadow-soft hover:-translate-y-0.5; }
    .btn-ghost{ @apply border border-slate-300 bg-white hover:bg-slate-50; }
    .card{ @apply rounded-2xl border border-slate-200 bg-white p-5 shadow-sm; }
    .chip{ @apply rounded-xl border px-2.5 py-1 text-xs; }
  </style>

  <!-- Chart.js (pro grafy) -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4"></script>
  <!-- Stripe.js (jen pokud použiješ Checkout z frontendu) -->
  <script src="https://js.stripe.com/v3/"></script>
</head>
<body class="bg-gradient-to-b from-slate-50 via-white to-slate-50 text-slate-900">

  <!-- ========== NAV ========== -->
  <header class="sticky top-0 z-50 border-b border-slate-200 bg-white/80 backdrop-blur">
    <div class="mx-auto flex max-w-7xl items-center justify-between px-6 py-4">
      <a href="#" class="flex items-center gap-3">
        <img src="logo.png" alt="StrategyMind logo" class="h-10 w-10 rounded-2xl" loading="eager" decoding="async">
        <span class="text-xl font-semibold tracking-tight">StrategyMind</span>
      </a>
      <nav class="hidden items-center gap-8 text-sm md:flex">
        <a class="hover:text-slate-700" href="#live">Live</a>
        <a class="hover:text-slate-700" href="#academy">Academy</a>
        <a class="hover:text-slate-700" href="#pricing">Ceník</a>
        <a class="hover:text-slate-700" href="#faq">FAQ</a>
      </nav>
      <div class="hidden md:block">
        <a href="#live" class="btn btn-brand">Spustit Live data</a>
      </div>
      <button id="menuBtn" class="md:hidden inline-flex h-10 w-10 items-center justify-center rounded-xl border border-slate-200">☰</button>
    </div>
    <div id="menuSheet" class="hidden border-t border-slate-200 md:hidden">
      <div class="mx-auto flex max-w-7xl flex-col gap-4 px-6 py-4 text-sm">
        <a href="#live" onclick="closeMenu()">Live</a>
        <a href="#academy" onclick="closeMenu()">Academy</a>
        <a href="#pricing" onclick="closeMenu()">Ceník</a>
        <a href="#faq" onclick="closeMenu()">FAQ</a>
      </div>
    </div>
  </header>

  <!-- ========== HERO ========== -->
  <main class="mx-auto grid max-w-7xl grid-cols-1 items-center gap-10 px-6 pb-12 pt-10 md:grid-cols-2">
    <div>
      <span class="inline-flex items-center gap-2 rounded-full border border-slate-200 bg-white/70 px-3 py-1 text-xs text-slate-600 shadow">
        ★ Live zprávy, akcie, indexy, ETF & crypto
      </span>
      <h1 class="mt-4 text-4xl font-extrabold tracking-tight sm:text-5xl">
        Jeden <span class="bg-gradient-to-r from-emerald-600 to-teal-400 bg-clip-text text-transparent">Live panel</span> pro trhy, zprávy a rozhodování
      </h1>
      <p class="mt-5 max-w-xl text-base leading-relaxed text-slate-600">
        Data tečou přes tvůj Cloudflare Worker. Připojky na Finnhub, Tavily (news), další fallbacky —
        a připraveno na realitní “cadastre” endpoint pro due-diligence.
      </p>
      <div class="mt-8 flex flex-wrap gap-2">
        <a href="#live" class="btn btn-brand">Otevřít Live přehled</a>
        <a href="#academy" class="btn btn-ghost">Otevřít Academy</a>
      </div>
    </div>
    <div class="relative">
      <div class="pointer-events-none absolute -inset-6 -z-10 rounded-[2rem] bg-gradient-to-tr from-emerald-500/20 via-teal-400/10 to-transparent blur-2xl"></div>
      <div class="relative mx-auto max-w-sm rounded-[2rem] border border-slate-200 bg-white p-8 shadow-2xl">
        <img src="logo.png" alt="StrategyMind" class="mx-auto h-40 w-40" loading="eager" decoding="async">
      </div>
    </div>
  </main>

  <!-- ========== LIVE DASHBOARD ========== -->
  <section id="live" class="border-t border-slate-200 bg-white/70 py-12">
    <div class="mx-auto max-w-7xl px-6">
      <div class="flex items-center justify-between gap-4">
        <h2 class="text-3xl font-bold tracking-tight">Live přehled</h2>
        <div class="text-xs text-slate-500">API: /api/market & /api/news z tvého Workera</div>
      </div>

      <!-- Ovládání -->
      <div class="mt-6 grid gap-3 sm:grid-cols-3">
        <!-- Symboly -->
        <div class="card">
          <div class="text-sm font-semibold">Rychlá volba trhů</div>
          <div class="mt-3 flex flex-wrap gap-2">
            <button class="chip live-symbol" data-symbol="SPY">SPY</button>
            <button class="chip live-symbol" data-symbol="QQQ">QQQ</button>
            <button class="chip live-symbol" data-symbol="AAPL">AAPL</button>
            <button class="chip live-symbol" data-symbol="MSFT">MSFT</button>
            <button class="chip live-symbol" data-symbol="BINANCE:BTCUSDT">BTC</button>
            <button class="chip live-symbol" data-symbol="BINANCE:ETHUSDT">ETH</button>
          </div>
        </div>

        <!-- Zprávy -->
        <div class="card">
          <div class="text-sm font-semibold">Zprávy</div>
          <div class="mt-3 flex flex-wrap gap-2">
            <button class="chip live-news" data-q="trhy">Trhy (CS)</button>
            <button class="chip live-news" data-q="inflace EU">Makro (EU)</button>
            <button class="chip live-news" data-q="nemovitosti ČR">Reality (CS)</button>
            <button class="chip live-news" data-q="AI business">AI Business</button>
          </div>
        </div>

        <!-- Rozsah / interval -->
        <div class="card">
          <div class="text-sm font-semibold">Časový rámec</div>
          <div class="mt-3 flex flex-wrap gap-2">
            <select id="live-range" class="rounded-xl border px-3 py-1 text-sm">
              <option value="5d">5 dní</option>
              <option value="1mo" selected>1 měsíc</option>
              <option value="3mo">3 měsíce</option>
              <option value="6mo">6 měsíců</option>
              <option value="1y">1 rok</option>
            </select>
            <select id="live-interval" class="rounded-xl border px-3 py-1 text-sm">
              <option value="15m">15m</option>
              <option value="1h">1h</option>
              <option value="1d" selected>1d</option>
            </select>
          </div>
        </div>
      </div>

      <!-- Hlavní karty (market + news) -->
      <div class="mt-6 grid gap-6 lg:grid-cols-3">
        <!-- Market karta -->
        <div class="card lg:col-span-2">
          <div class="flex flex-col gap-5 md:flex-row md:items-start md:justify-between">
            <div>
              <div id="mkt-symbol" class="text-sm font-semibold text-slate-700">SPY</div>
              <div class="mt-1 flex items-end gap-3">
                <div id="mkt-price" class="text-4xl font-extrabold">–</div>
                <div id="mkt-change" class="text-sm text-slate-500">–</div>
              </div>
              <div class="mt-2 text-xs text-slate-500">
                Close vs. prev. close. V grafu poslední uzavírací ceny (sparkline).
              </div>
            </div>
            <div class="w-full">
              <canvas id="mkt-chart" height="160"></canvas>
            </div>
          </div>
        </div>

        <!-- News karta -->
        <div class="card">
          <div class="flex items-center justify-between">
            <div class="text-sm font-semibold text-slate-700">Zprávy (top 10)</div>
            <a id="news-more" class="text-xs text-brand underline" target="_blank" rel="noopener">Otevřít API</a>
          </div>
          <div id="news-list" class="mt-4 space-y-3">
            <div class="text-sm text-slate-500">Načítám…</div>
          </div>
        </div>
      </div>

      <!-- Watchlist & Real-Estate -->
      <div class="mt-6 grid gap-6 md:grid-cols-2">
        <!-- Watchlist -->
        <div class="card">
          <div class="flex items-center justify-between">
            <div class="text-sm font-semibold">Watchlist</div>
            <div class="flex items-center gap-2">
              <input id="wl-input" placeholder="přidej symbol (např. NVDA)" class="rounded-xl border px-3 py-1 text-sm">
              <button id="wl-add" class="btn btn-ghost">Přidat</button>
            </div>
          </div>
          <div id="wl-list" class="mt-4 grid gap-3"></div>
        </div>

        <!-- Real-Estate (připraveno na katastr) -->
        <div class="card">
          <div class="text-sm font-semibold">Real-Estate – vyhledávání (připraveno na katastr)</div>
          <div class="mt-3 grid gap-2 sm:grid-cols-2">
            <input id="re-loc" placeholder="Region / město (např. Praha)" class="rounded-xl border px-3 py-2 text-sm">
            <select id="re-asset" class="rounded-xl border px-3 py-2 text-sm">
              <option value="apartment">Byt</option>
              <option value="house">Dům</option>
              <option value="land">Pozemek</option>
              <option value="commercial">Komerční</option>
            </select>
            <input id="re-budget" placeholder="Rozpočet (Kč)" class="rounded-xl border px-3 py-2 text-sm sm:col-span-2">
            <button id="re-run" class="btn btn-ghost sm:col-span-2">Analyzovat lokace</button>
          </div>
          <div id="re-out" class="mt-4 space-y-3 text-sm text-slate-700">
            <div class="text-slate-500 text-sm">Zatím vyhledává přes /api/news (keyword “real estate …”), napojení na katastr doplníme jako /api/cadastre.</div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- ========== ACADEMY (Trading & Business) ========== -->
  <section id="academy" class="border-t border-slate-200 bg-white/60 py-16">
    <div class="mx-auto max-w-7xl px-6">
      <h2 class="text-3xl font-bold tracking-tight">Academy</h2>
      <p class="mt-2 max-w-3xl text-slate-600">
        Výukové balíčky a checklisty pro **Trading** a **Podnikání** — zaměřeno na zvyky, procesy a rozhodování (money management).
      </p>

      <div class="mt-8 grid gap-6 md:grid-cols-3">
        <!-- Trading basics -->
        <div class="card">
          <div class="text-lg font-semibold">Trading — základy</div>
          <ul class="mt-3 list-disc pl-5 text-sm text-slate-700">
            <li>Plán obchodu (vstup, SL, PT, R:R ≥ 2)</li>
            <li>Riziko 0.5–1.5 % na obchod</li>
            <li>Denní / týdenní review</li>
          </ul>
        </div>

        <!-- Podnikání basics -->
        <div class="card">
          <div class="text-lg font-semibold">Podnikání — základy</div>
          <ul class="mt-3 list-disc pl-5 text-sm text-slate-700">
            <li>Validace nabídky (interview, MVP)</li>
            <li>Jedna jasná “North Star” metrika</li>
            <li>Distribuce (SEO + partners + social)</li>
          </ul>
        </div>

        <!-- Money management -->
        <div class="card">
          <div class="text-lg font-semibold">Money Management</div>
          <ul class="mt-3 list-disc pl-5 text-sm text-slate-700">
            <li>50/30/20 pravidlo (fixní/volný/investice)</li>
            <li>Nouzový fond 3–6 měsíců</li>
            <li>Automatizace (rychlé platby, investice)</li>
          </ul>
        </div>
      </div>
    </div>
  </section>

  <!-- ========== PRICING ========== -->
  <section id="pricing" class="border-y border-slate-200 bg-white/60 py-16">
    <div class="mx-auto max-w-7xl px-6">
      <h2 class="text-3xl font-bold tracking-tight">Ceník</h2>
      <p class="mt-2 max-w-2xl text-slate-600">Začni zdarma, Pro přes Stripe Checkout.</p>
      <div class="mt-8 grid gap-6 md:grid-cols-3">
        <div class="card">
          <h3 class="text-lg font-semibold">Starter</h3>
          <div class="mt-2 text-3xl font-extrabold">0</div>
          <ul class="mt-4 space-y-2 text-sm text-slate-600">
            <li>Live dashboard</li>
            <li>Watchlist</li>
            <li>News (základ)</li>
          </ul>
          <button class="btn btn-ghost mt-6">Používat zdarma</button>
        </div>

        <div class="card border-2 border-brand">
          <h3 class="text-lg font-semibold">Pro</h3>
          <div class="mt-2 text-3xl font-extrabold">499 Kč<span class="text-base font-semibold text-slate-600">/měs</span></div>
          <ul class="mt-4 space-y-2 text-sm text-slate-600">
            <li>AI sumáře + export</li>
            <li>Pokročilé filtry zpráv</li>
            <li>Brzy: realitní cadastre</li>
          </ul>
          <button id="buy-pro" class="btn btn-brand mt-6">Vybrat Pro</button>
          <div id="buy-msg" class="mt-2 text-xs text-slate-500"></div>
        </div>

        <div class="card">
          <h3 class="text-lg font-semibold">Enterprise</h3>
          <div class="mt-2 text-3xl font-extrabold">Na dotaz</div>
          <ul class="mt-4 space-y-2 text-sm text-slate-600">
            <li>SSO, SLA, audit</li>
            <li>On-prem & datové napojení</li>
            <li>Specifické modely</li>
          </ul>
          <a href="mailto:hello@strategymind.app" class="btn btn-ghost mt-6">Kontakt</a>
        </div>
      </div>
    </div>
  </section>

  <!-- ========== FAQ ========== -->
  <section id="faq" class="mx-auto max-w-7xl px-6 py-16">
    <h2 class="text-3xl font-bold tracking-tight">FAQ</h2>
    <div class="mt-6 grid gap-4 md:grid-cols-2">
      <details class="card open:shadow-sm">
        <summary class="cursor-pointer select-none text-sm font-semibold">Z čeho berete data?</summary>
        <p class="mt-2 text-sm text-slate-600">Ceny přes Finnhub; zprávy přes Tavily (fallback NewsAPI/SerpAPI). Vše přes tvůj Worker.</p>
      </details>
      <details class="card open:shadow-sm">
        <summary class="cursor-pointer select-none text-sm font-semibold">Jak přidám katastr?</summary>
        <p class="mt-2 text-sm text-slate-600">Doplníme /api/cadastre s vybraným zdrojem (např. ČÚZK/Overpass). Na frontendu už je sekce připravena.</p>
      </details>
      <details class="card open:shadow-sm">
        <summary class="cursor-pointer select-none text-sm font-semibold">Je Stripe Checkout bezpečný?</summary>
        <p class="mt-2 text-sm text-slate-600">Ano, platby jdou přímo přes Stripe. Frontend používá pouze publishable key.</p>
      </details>
      <details class="card open:shadow-sm">
        <summary class="cursor-pointer select-none text-sm font-semibold">Můžu vlastní symboly?</summary>
        <p class="mt-2 text-sm text-slate-600">Ano — přidej je ve Watchlistu nebo klikem na chipy nahoře.</p>
      </details>
    </div>
  </section>

  <!-- ========== FOOTER ========== -->
  <footer class="mx-auto max-w-7xl px-6 pb-10">
    <div class="rounded-2xl border border-slate-200 bg-white/70 p-5 text-xs text-slate-500 shadow-sm">© <span id="y"></span> StrategyMind</div>
  </footer>

  <!-- ========== APP SCRIPT ========== -->
  <script>
  // ------------- Konfigurace -------------
  // ⚠️ Zkontroluj adresu Workera (BASE):
  const BASE = "https://tight-field-436e.matejmelichr.workers.dev";
  // Stripe publishable key (může být prázdný — pak se tlačítko chová “Kontakt”):
  const STRIPE_PUBLISHABLE_KEY = "";  // např. "pk_live_..."
  // Pokud preferuješ Payment Link místo /api/checkout, vlož sem URL a checkout button bude link:
  const PAYMENT_LINK_URL = ""; // např. "https://buy.stripe.com/..."

  // ------------- UI drobnosti -------------
  const menuBtn=document.getElementById('menuBtn');
  const menuSheet=document.getElementById('menuSheet');
  function closeMenu(){ menuSheet.classList.add('hidden'); }
  menuBtn?.addEventListener('click',()=> menuSheet.classList.toggle('hidden'));
  document.getElementById('y').textContent = new Date().getFullYear();

  // ------------- Helpery -------------
  const el = (q)=>document.querySelector(q);
  const $symbol = el("#mkt-symbol");
  const $price  = el("#mkt-price");
  const $change = el("#mkt-change");
  const $range  = el("#live-range");
  const $interval = el("#live-interval");
  const $newsList = el("#news-list");
  const $newsMore = el("#news-more");
  const $wlInput  = el("#wl-input");
  const $wlAdd    = el("#wl-add");
  const $wlList   = el("#wl-list");
  const $reLoc    = el("#re-loc");
  const $reAsset  = el("#re-asset");
  const $reBudget = el("#re-budget");
  const $reRun    = el("#re-run");
  const $reOut    = el("#re-out");
  const $buyPro   = el("#buy-pro");
  const $buyMsg   = el("#buy-msg");

  const fmt = (n, d=2)=> (typeof n==="number" ? n.toFixed(d) : "–");
  function pct(curr, prev){ if(!prev || prev===0) return 0; return ((curr-prev)/prev*100); }

  async function safeJSON(url, opts){
    const r = await fetch(url, opts);
    const t = await r.text();
    try{ return JSON.parse(t); }catch{ return { ok:false, error:t||"Invalid JSON" }; }
  }

  // ------------- Market (hlavní karta) -------------
  let currentSymbol = "SPY";
  let chart;

  async function loadMarket(symbol){
    const url = `${BASE}/api/market?symbol=${encodeURIComponent(symbol)}&range=${$range.value}&interval=${$interval.value}`;
    const data = await safeJSON(url);
    if(!data?.ok){ $price.textContent = "–"; $change.textContent = "Chyba dat"; return; }

    // Quote
    const c = data.quote?.c;
    const pc = data.quote?.pc;
    $symbol.textContent = symbol;
    $price.textContent = typeof c === "number" ? fmt(c, 2) : "–";
    const p = pct(c, pc);
    if(pc){
      $change.textContent = `${fmt(p,2)}% vs. prev close`;
      $change.className = "text-sm " + (p>=0 ? "text-emerald-600" : "text-rose-600");
    }else{
      $change.textContent = "–";
    }

    // Candles → sparkline
    const t = data.candles?.t || [];
    const close = data.candles?.c || [];
    const labels = t.map(x=> new Date(x*1000).toLocaleDateString());
    const up = (close[close.length-1]??0) >= (close[0]??0);

    const ds = {
      labels,
      datasets: [{
        data: close,
        fill: true,
        borderWidth: 2,
        borderColor: up ? "rgba(5,150,105,1)" : "rgba(225,29,72,1)",
        backgroundColor: up ? "rgba(16,185,129,0.12)" : "rgba(244,63,94,0.12)",
        pointRadius: 0,
        tension: 0.25
      }]
    };
    if(chart){ chart.destroy(); }
    chart = new Chart(document.getElementById("mkt-chart").getContext("2d"), {
      type: "line",
      data: ds,
      options: { plugins:{legend:{display:false}}, scales:{x:{display:false}, y:{display:false}}, animation:false }
    });
  }

  // ------------- News (hlavní karta) -------------
  async function loadNews(q="trhy", lang="cs"){
    const url = `${BASE}/api/news?q=${encodeURIComponent(q)}&lang=${lang}&limit=10`;
    $newsMore.href = url;
    $newsList.innerHTML = `<div class="text-sm text-slate-500">Načítám…</div>`;
    const data = await safeJSON(url);
    $newsList.innerHTML = "";
    (data.items||[]).forEach(n=>{
      const a = document.createElement("a");
      a.className = "block rounded-xl border border-slate-200 p-3 hover:shadow-soft transition";
      a.href = n.url; a.target = "_blank"; a.rel = "noopener";
      a.innerHTML = `
        <div class="text-sm font-semibold">${n.title}</div>
        <div class="mt-1 text-xs text-slate-500">${(n.source||"").toString()} ${n.published_at?("• "+ new Date(n.published_at).toLocaleString()):""}</div>
        <p class="mt-1 text-sm text-slate-600">${n.snippet||""}</p>`;
      $newsList.appendChild(a);
    });
    if(!$newsList.childElementCount){
      $newsList.innerHTML = `<div class="text-sm text-slate-500">Žádné zprávy pro dotaz „${q}“.</div>`;
    }
  }

  // ------------- Watchlist -------------
  function wlRow(symbol){
    const row = document.createElement("div");
    row.className = "rounded-xl border border-slate-200 p-3";
    row.innerHTML = `
      <div class="flex items-center justify-between">
        <div class="text-sm font-semibold">${symbol}</div>
        <button class="text-xs text-rose-600 underline">Odebrat</button>
      </div>
      <div class="mt-2 grid gap-2 md:grid-cols-[130px_1fr]">
        <div class="text-sm">
          <div>Cena: <span class="wl-price">–</span></div>
          <div>Změna: <span class="wl-chg">–</span></div>
        </div>
        <canvas height="70"></canvas>
      </div>
    `;
    const btn = row.querySelector("button");
    btn.addEventListener("click", ()=> row.remove());
    // načti data
    (async()=>{
      const url = `${BASE}/api/market?symbol=${encodeURIComponent(symbol)}&range=1mo&interval=1d`;
      const data = await safeJSON(url);
      const price = row.querySelector(".wl-price");
      const chg = row.querySelector(".wl-chg");
      if(!data?.ok){ price.textContent="–"; chg.textContent="Chyba"; return; }
      const c = data.quote?.c, pc = data.quote?.pc;
      price.textContent = typeof c==="number" ? fmt(c) : "–";
      const p = pct(c, pc);
      chg.textContent = pc ? `${fmt(p,2)}%` : "–";
      chg.className = "wl-chg " + (p>=0?"text-emerald-600":"text-rose-600");

      // mini sparkline
      const t = data.candles?.t||[], close = data.candles?.c||[];
      const ctx = row.querySelector("canvas").getContext("2d");
      const up = (close[close.length-1]??0) >= (close[0]??0);
      new Chart(ctx, {
        type:"line",
        data:{ labels:t, datasets:[{ data:close, borderWidth:2, pointRadius:0,
          borderColor: up?"rgba(5,150,105,1)":"rgba(225,29,72,1)",
          backgroundColor: up?"rgba(16,185,129,0.12)":"rgba(244,63,94,0.12)",
          fill:true, tension:0.25 }] },
        options:{ plugins:{legend:{display:false}}, scales:{x:{display:false}, y:{display:false}}, animation:false}
      });
    })();
    return row;
  }

  // ------------- Real-Estate demo (používá /api/news) -------------
  async function runRealEstate(){
    const q = `real estate ${($reLoc.value||"").trim()} ${$reAsset.value} investment ${($reBudget.value||"").trim()}`;
    $reOut.innerHTML = `<div class="text-sm text-slate-500">Hledám „${q}“…</div>`;
    const data = await safeJSON(`${BASE}/api/news?q=${encodeURIComponent(q)}&lang=cs&limit=6`);
    $reOut.innerHTML = "";
    (data.items||[]).forEach(n=>{
      const box = document.createElement("a");
      box.className = "block rounded-xl border border-slate-200 p-3 hover:shadow-soft transition";
      box.href = n.url; box.target="_blank"; box.rel="noopener";
      box.innerHTML = `<div class="text-sm font-semibold">${n.title}</div>
        <div class="mt-1 text-xs text-slate-500">${n.source||""}</div>
        <p class="mt-1 text-sm text-slate-600">${n.snippet||""}</p>`;
      $reOut.appendChild(box);
    });
    if(!$reOut.childElementCount){
      $reOut.innerHTML = `<div class="text-sm text-slate-500">Nic relevantního. Zkus jiná klíčová slova.</div>`;
    }
  }

  // ------------- Stripe Checkout -------------
  async function handleBuyPro(){
    try{
      if(PAYMENT_LINK_URL){
        // Používáš Payment Link
        window.location.href = PAYMENT_LINK_URL;
        return;
      }
      if(!STRIPE_PUBLISHABLE_KEY){
        $buyMsg.textContent = "Pro přesměrování do Stripe zadej STRIPE_PUBLISHABLE_KEY nebo použij Payment Link.";
        return;
      }
      const stripe = window.Stripe(STRIPE_PUBLISHABLE_KEY);
      // Očekává se, že Worker má endpoint /api/checkout {url:...} nebo {id:...}
      const res = await safeJSON(`${BASE}/api/checkout`, { method:"POST" });
      if(res?.url){ window.location.href = res.url; return; }
      if(res?.id){ await stripe.redirectToCheckout({ sessionId: res.id }); return; }
      $buyMsg.textContent = "Backend session nebyla vrácena. Zkontroluj /api/checkout ve Workerovi.";
    }catch(e){
      console.warn(e); $buyMsg.textContent = "Nelze otevřít Stripe Checkout.";
    }
  }

  // ------------- Eventy -------------
  document.querySelectorAll(".live-symbol").forEach(b=>{
    b.addEventListener("click", ()=>{ currentSymbol=b.dataset.symbol; loadMarket(currentSymbol); });
  });
  document.querySelectorAll(".live-news").forEach(b=>{
    b.addEventListener("click", ()=> loadNews(b.dataset.q, "cs"));
  });
  $range.addEventListener("change", ()=> loadMarket(currentSymbol));
  $interval.addEventListener("change", ()=> loadMarket(currentSymbol));
  $wlAdd.addEventListener("click", ()=>{
    const s = ($wlInput.value||"").trim().toUpperCase();
    if(!s) return;
    $wlList.prepend(wlRow(s));
    $wlInput.value="";
  });
  $reRun.addEventListener("click", runRealEstate);
  $buyPro.addEventListener("click", handleBuyPro);

  // ------------- Start -------------
  loadMarket(currentSymbol);
  loadNews("trhy","cs");
  </script>
</body>
</html>
